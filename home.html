<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social App - Publish and Share Content with Firebase</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Global Styles */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        /* App Container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* Navigation */
        .nav-link {
            position: relative;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .nav-link.active {
            color: #4f46e5;
            font-weight: 600;
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #4f46e5;
        }
        
        /* Cards */
        .card {
            background: #fff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Post Styles */
        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
        }
        
        .post-video {
            width: 100%;
            max-height: 400px;
        }
        
        .post-content {
            padding: 1.25rem;
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            border-top: 1px solid #edf2f7;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Upload Page */
        .tab {
            display: none;
        }
        
        .tab.active {
            display: block;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
            font-weight: 600;
        }
        
        /* File Upload */
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .dropzone {
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .dropzone:hover {
            border-color: #4f46e5;
        }
        
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 0.25rem;
            overflow: hidden;
        }
        
        .preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-btn {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* Comment Section */
        .comment {
            padding: 0.75rem 0;
            border-bottom: 1px solid #edf2f7;
        }
        
        .comment:last-child {
            border-bottom: none;
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        /* PDF Optimization */
        @media print {
            body {
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .app-container {
                max-width: 100%;
            }
            
            .card {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 2rem;
            }
            
            .hide-in-print {
                display: none;
            }
        }

        /* Auth Forms */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        /* Dark Mode */
        .dark-theme {
            background-color: #1a202c;
            color: #e2e8f0;
        }

        .dark-theme .bg-white {
            background-color: #2d3748;
            color: #e2e8f0;
        }

        .dark-theme .text-gray-700, 
        .dark-theme .text-gray-800, 
        .dark-theme .text-gray-600, 
        .dark-theme .text-gray-500 {
            color: #cbd5e0;
        }

        .dark-theme .border-gray-200,
        .dark-theme .border-gray-300,
        .dark-theme .border-gray-100 {
            border-color: #4a5568;
        }

        .dark-theme .card,
        .dark-theme .auth-form,
        .dark-theme .bg-gray-100 {
            background-color: #2d3748;
            color: #e2e8f0;
        }

        .dark-theme input,
        .dark-theme textarea,
        .dark-theme select {
            background-color: #4a5568;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        .dark-theme input::placeholder,
        .dark-theme textarea::placeholder {
            color: #a0aec0;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px);
            animation: toast-in-out 3s ease forwards;
        }
        
        .toast.success {
            background-color: #10b981;
        }
        
        .toast.error {
            background-color: #ef4444;
        }
        
        @keyframes toast-in-out {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            10% {
                opacity: 1;
                transform: translateY(0);
            }
            90% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
    </style>
</head>
<body>
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="auth-form">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold" id="auth-modal-title">Sign In</h2>
                <button id="close-auth-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="login-email" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="login-password" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="pt-2">
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md">Sign In</button>
                </div>
                <div class="text-center text-sm">
                    <p>Don't have an account? <a href="#" id="show-signup" class="text-indigo-600 hover:text-indigo-800">Sign Up</a></p>
                </div>
            </form>

            <!-- Register Form -->
            <form id="signup-form" class="space-y-4 hidden">
                <div>
                    <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="signup-name" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="signup-email" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="signup-password" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="signup-confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="pt-2">
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md">Sign Up</button>
                </div>
                <div class="text-center text-sm">
                    <p>Already have an account? <a href="#" id="show-login" class="text-indigo-600 hover:text-indigo-800">Sign In</a></p>
                </div>
            </form>
        </div>
    </div>

    <header class="bg-white shadow-sm">
        <div class="app-container">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-indigo-600 mr-2">SocialApp</h1>
                    <span class="bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-0.5 rounded">Beta</span>
                </div>
                <div class="flex items-center">
                    <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 mr-2" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="relative" id="user-profile-container">
                        <button id="login-button" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                            Sign In
                        </button>
                        <div id="user-profile" class="hidden">
                            <img src="https://via.placeholder.com/40" alt="User profile" class="user-avatar cursor-pointer" id="profile-image">
                            <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-10">
                                <a href="#profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-page="profile">Your Profile</a>
                                <a href="#settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-page="settings">Settings</a>
                                <div class="border-t border-gray-100"></div>
                                <button id="logout-button" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <nav class="flex space-x-4 py-2 overflow-x-auto hide-in-print" id="main-nav">
                <a href="#home" class="nav-link active" data-page="home">
                    <i class="fas fa-home mr-2"></i>Home
                </a>
                <a href="#upload" class="nav-link auth-required" data-page="upload">
                    <i class="fas fa-plus mr-2"></i>Create
                </a>
                <a href="#profile" class="nav-link auth-required" data-page="profile">
                    <i class="fas fa-user mr-2"></i>Profile
                </a>
                <a href="#settings" class="nav-link auth-required" data-page="settings">
                    <i class="fas fa-cog mr-2"></i>Settings
                </a>
            </nav>
        </div>
    </header>

    <main class="app-container py-6">
        <!-- Home Page -->
        <div id="home-page" class="page active">
            <div class="mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">News Feed</h2>
                    <div class="flex items-center">
                        <div class="relative mr-4">
                            <input type="text" placeholder="Search posts..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-full w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <select class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="latest">Latest</option>
                            <option value="popular">Popular</option>
                            <option value="trending">Trending</option>
                        </select>
                    </div>
                </div>

                <!-- Stories -->
                <div class="flex space-x-4 overflow-x-auto pb-3 mb-4 hide-in-print auth-content">
                    <div class="flex-shrink-0 w-20">
                        <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full p-0.5">
                            <div class="w-full h-full bg-white rounded-full p-0.5">
                                <div class="w-full h-full bg-gray-200 rounded-full flex items-center justify-center">
                                    <i class="fas fa-plus text-gray-500"></i>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-center mt-1">Add Story</p>
                    </div>
                    
                    <div class="flex-shrink-0 w-20">
                        <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full p-0.5">
                            <img src="https://via.placeholder.com/150" alt="User story" class="w-full h-full object-cover rounded-full">
                        </div>
                        <p class="text-xs text-center mt-1">Your Story</p>
                    </div>
                </div>

                <!-- Posts -->
                <div class="posts-container" id="posts-container">
                    <!-- Posts will be loaded dynamically from Firebase -->
                    <div class="text-center py-10" id="posts-loading">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600"></div>
                        <p class="mt-2 text-gray-600">Loading posts...</p>
                    </div>
                </div>

                <!-- Load More Button -->
                <div class="text-center mt-6" id="load-more-container">
                    <button id="load-more" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Load More
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload Page -->
        <div id="upload-page" class="page hidden">
            <h2 class="text-2xl font-bold mb-6">Create New Post</h2>
            
            <!-- Tab Navigation -->
            <div class="flex border-b border-gray-200 mb-6 hide-in-print">
                <button class="tab-btn active" data-tab="text-tab">
                    <i class="fas fa-font mr-2"></i>Text
                </button>
                <button class="tab-btn" data-tab="image-tab">
                    <i class="fas fa-image mr-2"></i>Image
                </button>
                <button class="tab-btn" data-tab="video-tab">
                    <i class="fas fa-video mr-2"></i>Video
                </button>
            </div>
            
            <!-- Text Upload Tab -->
            <div id="text-tab" class="tab active">
                <form id="text-form" class="space-y-6">
                    <div>
                        <label for="text-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input type="text" id="text-title" placeholder="Add a title to your post" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label for="text-content" class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                        <textarea id="text-content" rows="6" placeholder="What's on your mind?" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="text-tags" class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                        <input type="text" id="text-tags" placeholder="Add tags separated by commas" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <p class="text-sm text-gray-500 mt-1">Example: #lifestyle, #inspiration, #design</p>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="text-comments" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                        <label for="text-comments" class="ml-2 block text-sm text-gray-700">Allow comments</label>
                    </div>
                    
                    <div>
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md shadow-md transition-all duration-300">
                            <i class="fas fa-paper-plane mr-2"></i>Publish Post
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Image Upload Tab -->
            <div id="image-tab" class="tab">
                <form id="image-form" class="space-y-6">
                    <div>
                        <label for="image-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input type="text" id="image-title" placeholder="Add a title to your post" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Upload Images</label>
                        <div id="image-dropzone" class="dropzone">
                            <input type="file" id="image-upload" class="file-input" accept="image/*" multiple>
                            <div class="text-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600">Drag and drop images here, or click to select files</p>
                                <p class="text-gray-500 text-sm mt-1">JPG, PNG, GIF files are allowed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-container" id="image-preview-container">
                        <!-- Image previews will appear here -->
                    </div>
                    
                    <div>
                        <label for="image-caption" class="block text-sm font-medium text-gray-700 mb-1">Caption</label>
                        <textarea id="image-caption" rows="3" placeholder="Add a caption to your images" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="image-tags" class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                        <input type="text" id="image-tags" placeholder="Add tags separated by commas" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="image-comments" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                            <label for="image-comments" class="ml-2 block text-sm text-gray-700">Allow comments</label>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="image-download" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                            <label for="image-download" class="ml-2 block text-sm text-gray-700">Allow downloads</label>
                        </div>
                    </div>
                    
                    <div>
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md shadow-md transition-all duration-300">
                            <i class="fas fa-images mr-2"></i>Publish Images
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Video Upload Tab -->
            <div id="video-tab" class="tab">
                <form id="video-form" class="space-y-6">
                    <div>
                        <label for="video-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input type="text" id="video-title" placeholder="Add a title to your video" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Upload Video</label>
                        <div id="video-dropzone" class="dropzone">
                            <input type="file" id="video-upload" class="file-input" accept="video/*">
                            <div class="text-center">
                                <i class="fas fa-film text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600">Drag and drop video here, or click to select file</p>
                                <p class="text-gray-500 text-sm mt-1">MP4, WebM, Ogg files are allowed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="video-preview-container" class="hidden">
                        <div class="mb-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Video Preview</h3>
                            <div class="rounded-lg overflow-hidden">
                                <video id="video-preview" controls playsinline webkit-playsinline class="w-full max-h-96 bg-black"></video>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Select Thumbnail</h3>
                            <div class="grid grid-cols-3 gap-3 mb-3" id="thumbnail-container">
                                <!-- Thumbnails will appear here -->
                            </div>
                            
                            <div>
                                <label class="flex items-center cursor-pointer text-indigo-600 hover:text-indigo-800 text-sm">
                                    <i class="fas fa-plus-circle mr-1"></i> 
                                    <span>Upload custom thumbnail</span>
                                    <input type="file" id="custom-thumbnail" accept="image/*" class="hidden">
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="video-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="video-description" rows="3" placeholder="Add a description to your video" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="video-tags" class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                        <input type="text" id="video-tags" placeholder="Add tags separated by commas" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="video-comments" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                            <label for="video-comments" class="ml-2 block text-sm text-gray-700">Allow comments</label>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="video-download" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                            <label for="video-download" class="ml-2 block text-sm text-gray-700">Allow downloads</label>
                        </div>
                    </div>
                    
                    <div>
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md shadow-md transition-all duration-300">
                            <i class="fas fa-video mr-2"></i>Publish Video
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Profile Page (Hidden by Default) -->
        <div id="profile-page" class="page hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img src="https://via.placeholder.com/150" alt="Profile picture" class="w-32 h-32 rounded-full mx-auto border-4 border-white shadow-lg" id="profile-page-image">
                        <button class="absolute bottom-0 right-0 bg-indigo-600 text-white rounded-full p-2 hover:bg-indigo-700" id="change-profile-image">
                            <i class="fas fa-camera"></i>
                            <input type="file" id="profile-image-upload" accept="image/*" class="hidden">
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mt-4" id="profile-user-name">User Name</h2>
                    <p class="text-gray-600" id="profile-user-bio">User Bio</p>
                    <div class="flex justify-center mt-2" id="user-tags">
                        <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded mr-2">Photography</span>
                        <span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded mr-2">Travel</span>
                        <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded">Design</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-6 text-center">
                    <div>
                        <h4 class="text-2xl font-bold" id="user-post-count">0</h4>
                        <p class="text-gray-600">Posts</p>
                    </div>
                    <div>
                        <h4 class="text-2xl font-bold" id="user-followers">0</h4>
                        <p class="text-gray-600">Followers</p>
                    </div>
                    <div>
                        <h4 class="text-2xl font-bold" id="user-following">0</h4>
                        <p class="text-gray-600">Following</p>
                    </div>
                </div>
                
                <div class="border-t border-gray-200 pt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">About Me</h3>
                        <button class="text-indigo-600 hover:text-indigo-800 text-sm" id="edit-profile-btn">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                    </div>
                    <p class="text-gray-700" id="user-about">User biography and information will appear here.</p>
                </div>
            </div>
            
            <!-- User Posts -->
            <div class="mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">My Posts</h3>
                    <div class="flex space-x-2">
                        <button class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded-md active" id="grid-view-btn">
                            <i class="fas fa-th mr-1"></i>Grid
                        </button>
                        <button class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded-md" id="list-view-btn">
                            <i class="fas fa-list mr-1"></i>List
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-3" id="user-posts-grid">
                    <!-- User posts will be loaded here -->
                    <div class="text-center py-10 col-span-3" id="user-posts-loading">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600"></div>
                        <p class="mt-2 text-gray-600">Loading your posts...</p>
                    </div>
                </div>
                
                <div class="space-y-4 hidden" id="user-posts-list">
                    <!-- List view of posts will be here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="settings-page" class="page hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">Account Settings</h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Personal Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="fullname" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="fullname" placeholder="Enter your full name" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                <input type="text" id="username" placeholder="Enter your username" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="settings-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                <input type="email" id="settings-email" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="tel" id="phone" placeholder="Enter your phone number" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="bio" class="block text-sm font-medium text-gray-700 mb-1">Biography</label>
                                <textarea id="bio" rows="4" placeholder="Tell us about yourself" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="text-lg font-semibold mb-4">Privacy Settings</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Profile Visibility</h4>
                                    <p class="text-sm text-gray-600">Control who can see your profile</p>
                                </div>
                                <select id="profile-visibility" class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="public">Public</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="private">Private</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Post Comments</h4>
                                    <p class="text-sm text-gray-600">Allow others to comment on your posts</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" id="allow-comments">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Tag Notifications</h4>
                                    <p class="text-sm text-gray-600">Receive notifications when tagged</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" id="tag-notifications">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Download Permission</h4>
                                    <p class="text-sm text-gray-600">Allow users to download your content</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" id="download-permission">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="text-lg font-semibold mb-4">Notification Settings</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Email Notifications</h4>
                                    <p class="text-sm text-gray-600">Receive notifications via email</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" id="email-notifications">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Push Notifications</h4>
                                    <p class="text-sm text-gray-600">Receive notifications on your device</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" id="push-notifications">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Marketing Emails</h4>
                                    <p class="text-sm text-gray-600">Receive promotional content</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" id="marketing-emails">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-md" id="settings-cancel">Cancel</button>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md" id="settings-save">Save Changes</button>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-red-600">Danger Zone</h3>
                <p class="text-gray-600 mb-4">These actions are irreversible. Please proceed with caution.</p>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-4 border border-gray-200 rounded-md">
                        <div>
                            <h4 class="font-medium">Reset Password</h4>
                            <p class="text-sm text-gray-600">Send a password reset email to your registered email address</p>
                        </div>
                        <button class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md" id="reset-password-btn">
                            Reset Password
                        </button>
                    </div>
                    
                    <div class="flex justify-between items-center p-4 border border-gray-200 rounded-md">
                        <div>
                            <h4 class="font-medium">Delete Account</h4>
                            <p class="text-sm text-gray-600">Permanently delete your account and all associated data</p>
                        </div>
                        <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md" id="delete-account-btn">
                            Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-6 mt-8 hide-in-print">
        <div class="app-container">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold text-indigo-600">SocialApp</h3>
                    <p class="text-gray-600 text-sm">Connect, Share, and Discover</p>
                </div>
                
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-600 hover:text-indigo-600">
                        <i class="fab fa-facebook-square text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600">
                        <i class="fab fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600">
                        <i class="fab fa-youtube text-xl"></i>
                    </a>
                </div>
            </div>
            
            <div class="mt-6 text-center text-gray-500 text-sm">
                <p>&copy; 2023 SocialApp. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Delete Account Confirmation Modal -->
    <div id="delete-account-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6">
            <h3 class="text-xl font-bold text-red-600 mb-4">Delete Account</h3>
            <p class="text-gray-700 mb-6">Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently removed.</p>
            
            <div class="mb-4">
                <label for="delete-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm your password</label>
                <input type="password" id="delete-password" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md">Cancel</button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md">Delete My Account</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Edit Profile</h3>
                <button id="close-edit-profile" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="edit-profile-form" class="space-y-4">
                <div>
                    <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="edit-name" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                
                <div>
                    <label for="edit-bio" class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                    <textarea id="edit-bio" rows="3" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
                
                <div>
                    <label for="edit-interests" class="block text-sm font-medium text-gray-700 mb-1">Interests</label>
                    <input type="text" id="edit-interests" placeholder="Travel, Photography, Design..." class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <p class="text-xs text-gray-500 mt-1">Separate interests with commas</p>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-edit-profile" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBGm3aMGnDYrl7HJ-QvNfmMhIpdMBmfXtM",
                authDomain: "socialapp-demo-123.firebaseapp.com",
                projectId: "socialapp-demo-123",
                storageBucket: "socialapp-demo-123.appspot.com",
                messagingSenderId: "123456789012",
                appId: "1:123456789012:web:abc123def456ghi789jkl"
            };
            
            // Initialize Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            // Get Firebase services
            const auth = firebase.auth();
            const db = firebase.firestore();
            const storage = firebase.storage();
            
            // DOM Elements - Auth
            const loginButton = document.getElementById('login-button');
            const userProfile = document.getElementById('user-profile');
            const profileImage = document.getElementById('profile-image');
            const userDropdown = document.getElementById('user-dropdown');
            const logoutButton = document.getElementById('logout-button');
            const authModal = document.getElementById('auth-modal');
            const closeAuthModal = document.getElementById('close-auth-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const showSignup = document.getElementById('show-signup');
            const showLogin = document.getElementById('show-login');
            const authElements = document.querySelectorAll('.auth-required');
            const authContent = document.querySelectorAll('.auth-content');
            
            // Profile elements
            const changeProfileImageBtn = document.getElementById('change-profile-image');
            const profileImageUpload = document.getElementById('profile-image-upload');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const editProfileModal = document.getElementById('edit-profile-modal');
            const closeEditProfileBtn = document.getElementById('close-edit-profile');
            const cancelEditProfileBtn = document.getElementById('cancel-edit-profile');
            const editProfileForm = document.getElementById('edit-profile-form');
            
            // Settings elements
            const resetPasswordBtn = document.getElementById('reset-password-btn');
            const deleteAccountBtn = document.getElementById('delete-account-btn');
            const deleteAccountModal = document.getElementById('delete-account-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            const settingsSaveBtn = document.getElementById('settings-save');
            const settingsCancelBtn = document.getElementById('settings-cancel');
            
            // Variables
            let currentUser = null;
            let userPostData = [];
            let postsPerPage = 5;
            let lastDoc = null;
            let selectedThumbnailFile = null;
            let selectedFiles = [];
            
            // Authentication state observer
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    
                    // Update UI
                    loginButton.classList.add('hidden');
                    userProfile.classList.remove('hidden');
                    
                    // Allow access to auth required pages
                    authElements.forEach(element => {
                        element.classList.remove('hidden');
                    });
                    
                    // Show auth content
                    authContent.forEach(content => {
                        content.classList.remove('hidden');
                    });
                    
                    // Get user profile data
                    getUserProfile(user.uid);
                    
                    // Load user posts
                    loadUserPosts(user.uid);
                    
                    // Close auth modal if open
                    authModal.classList.add('hidden');
                    
                    // Update profile image
                    if (user.photoURL) {
                        profileImage.src = user.photoURL;
                    }
                    
                } else {
                    // User is signed out
                    currentUser = null;
                    
                    // Update UI
                    loginButton.classList.remove('hidden');
                    userProfile.classList.add('hidden');
                    
                    // Restrict access to auth required pages
                    authElements.forEach(element => {
                        element.classList.add('hidden');
                    });
                    
                    // Hide auth content
                    authContent.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // If on auth required page, redirect to home
                    const currentPage = document.querySelector('.page.active');
                    if (currentPage && !currentPage.id.includes('home')) {
                        navigateToPage('home');
                    }
                }
                
                // Load posts regardless of auth state
                loadPosts(true);
            });
            
            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-page');
                    
                    // Check if auth required
                    if (this.classList.contains('auth-required') && !currentUser) {
                        showAuthModal();
                        return;
                    }
                    
                    navigateToPage(targetPage);
                });
            });
            
            // Check hash for direct navigation
            function checkHash() {
                const hash = window.location.hash.substr(1);
                if (hash) {
                    const parts = hash.split('/');
                    const page = parts[0];
                    
                    if (page && document.querySelector(`.nav-link[data-page="${page}"]`)) {
                        const link = document.querySelector(`.nav-link[data-page="${page}"]`);
                        
                        if (link.classList.contains('auth-required') && !currentUser) {
                            showAuthModal();
                            return;
                        }
                        
                        navigateToPage(page);
                        
                        // Handle post viewing if in format #post/123
                        if (parts[0] === 'post' && parts[1]) {
                            // Implement post view logic
                        }
                    }
                }
            }
            
            // Check hash on load and when it changes
            window.addEventListener('hashchange', checkHash);
            setTimeout(checkHash, 500); // Slight delay to ensure auth state is checked first
            
            function navigateToPage(targetPage) {
                // Update hash
                window.location.hash = targetPage;
                
                // Update active navigation link
                navLinks.forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-link[data-page="${targetPage}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                // Show the corresponding page
                pages.forEach(page => {
                    if (page.id === `${targetPage}-page`) {
                        page.classList.remove('hidden');
                        page.classList.add('active', 'fade-in');
                    } else {
                        page.classList.add('hidden');
                        page.classList.remove('active');
                    }
                });
            }
            
            // Tab switching for Upload page
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabs = document.querySelectorAll('.tab');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show the corresponding tab
                    tabs.forEach(tab => {
                        if (tab.id === targetTab) {
                            tab.classList.add('active', 'fade-in');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                });
            });
            
            // Auth functions
            loginButton.addEventListener('click', showAuthModal);
            
            closeAuthModal.addEventListener('click', () => {
                authModal.classList.add('hidden');
            });
            
            showSignup.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                document.getElementById('auth-modal-title').textContent = 'Sign Up';
            });
            
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                signupForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                document.getElementById('auth-modal-title').textContent = 'Sign In';
            });
            
            function showAuthModal() {
                authModal.classList.remove('hidden');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                document.getElementById('auth-modal-title').textContent = 'Sign In';
            }
            
            // Login form submit
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;
                
                // Validate input
                if (!email || !password) {
                    showToast('Please fill in all fields', 'error');
                    return;
                }
                
                // Show loading
                showLoading('Signing in...');
                
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        hideLoading();
                        showToast('Successfully logged in!', 'success');
                        document.getElementById('login-email').value = '';
                        document.getElementById('login-password').value = '';
                    })
                    .catch((error) => {
                        hideLoading();
                        let errorMessage = 'Authentication failed';
                        
                        // Provide specific error messages
                        if (error.code === 'auth/user-not-found') {
                            errorMessage = 'No account found with this email';
                        } else if (error.code === 'auth/wrong-password') {
                            errorMessage = 'Incorrect password';
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = 'Invalid email format';
                        } else if (error.code === 'auth/too-many-requests') {
                            errorMessage = 'Too many failed attempts. Try again later';
                        }
                        
                        showToast(errorMessage, 'error');
                    });
            });
            
            // Signup form submit
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('signup-name').value.trim();
                const email = document.getElementById('signup-email').value.trim();
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                
                // Validate input
                if (!name || !email || !password || !confirmPassword) {
                    showToast('Please fill in all fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }
                
                // Show loading
                showLoading('Creating account...');
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Create user profile
                        return db.collection('users').doc(user.uid).set({
                            name: name,
                            email: email,
                            bio: '',
                            interests: [],
                            profileImage: 'https://via.placeholder.com/150',
                            username: email.split('@')[0],
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            settings: {
                                allowComments: true,
                                tagNotifications: true,
                                downloadPermission: false,
                                emailNotifications: true,
                                pushNotifications: true,
                                marketingEmails: false,
                                profileVisibility: 'public'
                            }
                        });
                    })
                    .then(() => {
                        hideLoading();
                        showToast('Account created successfully!', 'success');
                        
                        // Clear form
                        document.getElementById('signup-name').value = '';
                        document.getElementById('signup-email').value = '';
                        document.getElementById('signup-password').value = '';
                        document.getElementById('signup-confirm-password').value = '';
                    })
                    .catch((error) => {
                        hideLoading();
                        let errorMessage = 'Account creation failed';
                        
                        // Provide specific error messages
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = 'Email is already in use';
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = 'Invalid email format';
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = 'Password is too weak';
                        }
                        
                        showToast(errorMessage, 'error');
                    });
            });
            
            // Logout
            logoutButton.addEventListener('click', () => {
                auth.signOut()
                    .then(() => {
                        showToast('You have been signed out', 'success');
                    })
                    .catch((error) => {
                        showToast('Error signing out: ' + error.message, 'error');
                    });
            });
            
            // User profile dropdown
            profileImage.addEventListener('click', () => {
                userDropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!profileImage.contains(e.target)) {
                    userDropdown.classList.add('hidden');
                }
            });
            
            // Change profile image
            changeProfileImageBtn.addEventListener('click', () => {
                profileImageUpload.click();
            });
            
            profileImageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (!file.type.match('image.*')) {
                        showToast('Please select an image file', 'error');
                        return;
                    }
                    
                    showLoading('Uploading image...');
                    
                    // Upload to Firebase Storage
                    const storageRef = storage.ref(`profile_images/${currentUser.uid}/${Date.now()}-${file.name}`);
                    const uploadTask = storageRef.put(file);
                    
                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            // Progress function
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            console.log('Upload is ' + progress + '% done');
                        }, 
                        (error) => {
                            // Error function
                            hideLoading();
                            showToast('Error uploading image: ' + error.message, 'error');
                        }, 
                        () => {
                            // Complete function
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                // Update user profile
                                updateProfileImage(downloadURL);
                            });
                        }
                    );
                }
            });
            
            function updateProfileImage(imageUrl) {
                // Update auth profile
                currentUser.updateProfile({
                    photoURL: imageUrl
                }).then(() => {
                    // Update Firestore profile
                    return db.collection('users').doc(currentUser.uid).update({
                        profileImage: imageUrl
                    });
                }).then(() => {
                    // Update UI
                    const profileImgElements = document.querySelectorAll('#profile-image, #profile-page-image');
                    profileImgElements.forEach(img => {
                        img.src = imageUrl;
                    });
                    
                    hideLoading();
                    showToast('Profile image updated successfully', 'success');
                }).catch(error => {
                    hideLoading();
                    showToast('Error updating profile image: ' + error.message, 'error');
                });
            }
            
            // Edit profile
            editProfileBtn.addEventListener('click', () => {
                if (!currentUser) return;
                
                // Get user data
                db.collection('users').doc(currentUser.uid).get().then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        
                        // Populate form
                        document.getElementById('edit-name').value = userData.name || '';
                        document.getElementById('edit-bio').value = userData.bio || '';
                        document.getElementById('edit-interests').value = 
                            Array.isArray(userData.interests) ? userData.interests.join(', ') : '';
                        
                        // Show modal
                        editProfileModal.classList.remove('hidden');
                    }
                }).catch(error => {
                    showToast('Error loading profile data: ' + error.message, 'error');
                });
            });
            
            closeEditProfileBtn.addEventListener('click', () => {
                editProfileModal.classList.add('hidden');
            });
            
            cancelEditProfileBtn.addEventListener('click', () => {
                editProfileModal.classList.add('hidden');
            });
            
            editProfileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('edit-name').value.trim();
                const bio = document.getElementById('edit-bio').value.trim();
                const interestsInput = document.getElementById('edit-interests').value.trim();
                
                // Process interests into array
                const interests = interestsInput 
                    ? interestsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) 
                    : [];
                
                showLoading('Saving profile...');
                
                // Update profile in Firestore
                db.collection('users').doc(currentUser.uid).update({
                    name: name,
                    bio: bio,
                    interests: interests,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    // Update display name in Auth
                    return currentUser.updateProfile({
                        displayName: name
                    });
                }).then(() => {
                    // Update UI
                    document.getElementById('profile-user-name').textContent = name;
                    document.getElementById('profile-user-bio').textContent = bio || 'No bio yet';
                    document.getElementById('user-about').textContent = bio || 'No information provided.';
                    
                    // Update interests/tags
                    updateUserTagsDisplay(interests);
                    
                    hideLoading();
                    showToast('Profile updated successfully', 'success');
                    editProfileModal.classList.add('hidden');
                    
                }).catch(error => {
                    hideLoading();
                    showToast('Error updating profile: ' + error.message, 'error');
                });
            });
            
            function updateUserTagsDisplay(interests) {
                const userTags = document.getElementById('user-tags');
                userTags.innerHTML = '';
                
                if (interests && interests.length) {
                    // Define a set of tag colors
                    const tagColors = [
                        {bg: 'bg-blue-100', text: 'text-blue-800'},
                        {bg: 'bg-green-100', text: 'text-green-800'},
                        {bg: 'bg-purple-100', text: 'text-purple-800'},
                        {bg: 'bg-red-100', text: 'text-red-800'},
                        {bg: 'bg-yellow-100', text: 'text-yellow-800'}
                    ];
                    
                    interests.forEach((interest, index) => {
                        // Cycle through colors
                        const colorSet = tagColors[index % tagColors.length];
                        
                        const tagSpan = document.createElement('span');
                        tagSpan.className = `${colorSet.bg} ${colorSet.text} text-xs font-semibold px-2.5 py-0.5 rounded mr-2 mb-2`;
                        tagSpan.textContent = interest;
                        userTags.appendChild(tagSpan);
                    });
                }
            }
            
            // Get user profile data
            function getUserProfile(userId) {
                db.collection('users').doc(userId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            
                            // Update UI elements
                            document.getElementById('profile-user-name').textContent = userData.name || 'User';
                            document.getElementById('profile-user-bio').textContent = userData.bio || 'No bio yet';
                            document.getElementById('user-about').textContent = userData.bio || 'No information provided.';
                            
                            // Update settings form
                            document.getElementById('fullname').value = userData.name || '';
                            document.getElementById('username').value = userData.username || '';
                            document.getElementById('settings-email').value = userData.email || '';
                            document.getElementById('phone').value = userData.phone || '';
                            document.getElementById('bio').value = userData.bio || '';
                            
                            // Update profile images
                            if (userData.profileImage) {
                                const profileImgElements = document.querySelectorAll('#profile-image, #profile-page-image');
                                profileImgElements.forEach(img => {
                                    img.src = userData.profileImage;
                                });
                            }
                            
                            // Update user tags/interests
                            if (userData.interests && Array.isArray(userData.interests)) {
                                updateUserTagsDisplay(userData.interests);
                            }
                            
                            // Update settings toggles
                            if (userData.settings) {
                                const settings = userData.settings;
                                
                                // Profile visibility
                                if (settings.profileVisibility) {
                                    document.getElementById('profile-visibility').value = settings.profileVisibility;
                                }
                                
                                // Toggle switches
                                document.getElementById('allow-comments').checked = 
                                    settings.allowComments !== false;
                                document.getElementById('tag-notifications').checked = 
                                    settings.tagNotifications !== false;
                                document.getElementById('download-permission').checked = 
                                    settings.downloadPermission === true;
                                document.getElementById('email-notifications').checked = 
                                    settings.emailNotifications !== false;
                                document.getElementById('push-notifications').checked = 
                                    settings.pushNotifications !== false;
                                document.getElementById('marketing-emails').checked = 
                                    settings.marketingEmails === true;
                            }
                            
                            // Update follower counts
                            updateFollowerCounts(userId);
                        }
                    })
                    .catch((error) => {
                        console.error("Error getting user profile: ", error);
                        showToast('Error loading profile', 'error');
                    });
            }
            
            // Update follower counts
            function updateFollowerCounts(userId) {
                // Get followers
                db.collection('followers')
                    .where('followingId', '==', userId)
                    .get()
                    .then(snapshot => {
                        document.getElementById('user-followers').textContent = snapshot.size;
                    });
                
                // Get following
                db.collection('followers')
                    .where('followerId', '==', userId)
                    .get()
                    .then(snapshot => {
                        document.getElementById('user-following').textContent = snapshot.size;
                    });
            }
            
            // Image Upload Functionality
            const imageUpload = document.getElementById('image-upload');
            const imageDropzone = document.getElementById('image-dropzone');
            const imagePreviewContainer = document.getElementById('image-preview-container');
            
            imageUpload.addEventListener('change', handleImageUpload);
            
            imageDropzone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('border-indigo-500');
            });
            
            imageDropzone.addEventListener('dragleave', function() {
                this.classList.remove('border-indigo-500');
            });
            
            imageDropzone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('border-indigo-500');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    // Create a new DataTransfer object
                    const dataTransfer = new DataTransfer();
                    
                    // Add files to DataTransfer object
                    Array.from(files).forEach(file => {
                        if (file.type.startsWith('image/')) {
                            dataTransfer.items.add(file);
                        }
                    });
                    
                    // Assign files to file input
                    imageUpload.files = dataTransfer.files;
                    handleImageUpload();
                }
            });
            
            function handleImageUpload() {
                const files = imageUpload.files;
                selectedFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
                
                // Clear previous previews
                imagePreviewContainer.innerHTML = '';
                
                if (selectedFiles.length === 0) {
                    return;
                }
                
                selectedFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.dataset.index = index;
                        
                        const previewImage = document.createElement('img');
                        previewImage.className = 'preview-image';
                        previewImage.src = e.target.result;
                        previewImage.alt = 'Image preview';
                        
                        const removeButton = document.createElement('button');
                        removeButton.className = 'remove-btn';
                        removeButton.innerHTML = '<i class="fas fa-times"></i>';
                        removeButton.addEventListener('click', function() {
                            const index = parseInt(previewItem.dataset.index);
                            selectedFiles.splice(index, 1);
                            previewItem.remove();
                            // Reindex remaining previews
                            const remainingPreviews = imagePreviewContainer.querySelectorAll('.preview-item');
                            remainingPreviews.forEach((preview, idx) => {
                                preview.dataset.index = idx;
                            });
                        });
                        
                        previewItem.appendChild(previewImage);
                        previewItem.appendChild(removeButton);
                        imagePreviewContainer.appendChild(previewItem);
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
            
            // Video Upload Functionality
            const videoUpload = document.getElementById('video-upload');
            const videoDropzone = document.getElementById('video-dropzone');
            const videoPreview = document.getElementById('video-preview');
            const videoPreviewContainer = document.getElementById('video-preview-container');
            const thumbnailContainer = document.getElementById('thumbnail-container');
            const customThumbnail = document.getElementById('custom-thumbnail');
            
            videoUpload.addEventListener('change', handleVideoUpload);
            
            videoDropzone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('border-indigo-500');
            });
            
            videoDropzone.addEventListener('dragleave', function() {
                this.classList.remove('border-indigo-500');
            });
            
            videoDropzone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('border-indigo-500');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('video/')) {
                    // Create a new DataTransfer object
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(files[0]);
                    
                    // Assign file to video upload input
                    videoUpload.files = dataTransfer.files;
                    handleVideoUpload();
                }
            });
            
            function handleVideoUpload() {
                const file = videoUpload.files[0];
                
                if (file && file.type.startsWith('video/')) {
                    const videoURL = URL.createObjectURL(file);
                    videoPreview.src = videoURL;
                    videoPreviewContainer.classList.remove('hidden');
                    
                    videoPreview.onloadeddata = function() {
                        generateThumbnails(videoPreview);
                    };
                }
            }
            
            function generateThumbnails(video) {
                thumbnailContainer.innerHTML = '';
                
                for (let i = 0; i < 3; i++) {
                    const thumbnailTime = i * (video.duration / 3);
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = 160;
                    canvas.height = 90;
                    
                    const thumbnailWrapper = document.createElement('div');
                    thumbnailWrapper.className = 'relative cursor-pointer border-2 border-transparent hover:border-indigo-500 rounded-md overflow-hidden';
                    thumbnailWrapper.onclick = function() {
                        document.querySelectorAll('#thumbnail-container > div').forEach(el => {
                            el.classList.remove('border-indigo-500');
                            el.classList.add('border-transparent');
                        });
                        this.classList.remove('border-transparent');
                        this.classList.add('border-indigo-500');
                        
                        // Generate thumbnail file from canvas
                        canvas.toBlob((blob) => {
                            selectedThumbnailFile = new File([blob], `thumbnail-${Date.now()}.png`, { type: 'image/png' });
                        }, 'image/png');
                    };
                    
                    const thumbnailCanvas = document.createElement('div');
                    thumbnailCanvas.className = 'w-full h-16 bg-gray-900';
                    
                    thumbnailWrapper.appendChild(thumbnailCanvas);
                    thumbnailContainer.appendChild(thumbnailWrapper);
                    
                    setTimeout(() => {
                        video.currentTime = thumbnailTime;
                        
                        video.addEventListener('seeked', function handler() {
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            thumbnailCanvas.style.backgroundImage = `url(${canvas.toDataURL()})`;
                            thumbnailCanvas.style.backgroundSize = 'cover';
                            thumbnailCanvas.style.backgroundPosition = 'center';
                            
                            // Select the first thumbnail by default
                            if (i === 0) {
                                thumbnailWrapper.click();
                            }
                            
                            video.removeEventListener('seeked', handler);
                        });
                    }, (i + 1) * 100);
                }
            }
            
            customThumbnail.addEventListener('change', function(e) {
                const file = e.target.files[0];
                
                if (file && file.type.startsWith('image/')) {
                    selectedThumbnailFile = file;
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const thumbnailWrapper = document.createElement('div');
                        thumbnailWrapper.className = 'relative cursor-pointer border-2 border-indigo-500 rounded-md overflow-hidden';
                        
                        const thumbnailImg = document.createElement('div');
                        thumbnailImg.className = 'w-full h-16';
                        thumbnailImg.style.backgroundImage = `url(${e.target.result})`;
                        thumbnailImg.style.backgroundSize = 'cover';
                        thumbnailImg.style.backgroundPosition = 'center';
                        
                        thumbnailWrapper.appendChild(thumbnailImg);
                        
                        // Deselect all other thumbnails
                        document.querySelectorAll('#thumbnail-container > div').forEach(el => {
                            el.classList.remove('border-indigo-500');
                            el.classList.add('border-transparent');
                        });
                        
                        // Add custom thumbnail at the beginning
                        if (thumbnailContainer.firstChild) {
                            thumbnailContainer.insertBefore(thumbnailWrapper, thumbnailContainer.firstChild);
                        } else {
                            thumbnailContainer.appendChild(thumbnailWrapper);
                        }
                        
                        // Add click handler to select/deselect
                        thumbnailWrapper.addEventListener('click', function() {
                            document.querySelectorAll('#thumbnail-container > div').forEach(el => {
                                el.classList.remove('border-indigo-500');
                                el.classList.add('border-transparent');
                            });
                            this.classList.remove('border-transparent');
                            this.classList.add('border-indigo-500');
                        });
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Form submissions
            const textForm = document.getElementById('text-form');
            const imageForm = document.getElementById('image-form');
            const videoForm = document.getElementById('video-form');
            
            textForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    showAuthModal();
                    return;
                }
                
                const title = document.getElementById('text-title').value.trim();
                const content = document.getElementById('text-content').value.trim();
                const tagsInput = document.getElementById('text-tags').value.trim();
                const allowComments = document.getElementById('text-comments').checked;
                
                // Process tags
                const tags = tagsInput 
                    ? tagsInput.split(',').map(tag => tag.trim().replace(/^#/, '')).filter(tag => tag.length > 0) 
                    : [];
                
                if (!title || !content) {
                    showToast('Please fill in title and content fields', 'error');
                    return;
                }
                
                showLoading('Publishing post...');
                
                // Get user info first
                getUserInfo(currentUser.uid).then(userInfo => {
                    // Add post to Firestore
                    const postData = {
                        userId: currentUser.uid,
                        userName: userInfo.name || 'User',
                        userImage: userInfo.profileImage || 'https://via.placeholder.com/40',
                        type: 'text',
                        title: title,
                        content: content,
                        tags: tags,
                        allowComments: allowComments,
                        likes: 0,
                        comments: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    return db.collection('posts').add(postData);
                })
                .then(() => {
                    hideLoading();
                    showToast('Post published successfully!', 'success');
                    textForm.reset();
                    navigateToPage('home');
                    loadPosts(true); // Reload posts
                })
                .catch((error) => {
                    hideLoading();
                    showToast('Error publishing post: ' + error.message, 'error');
                });
            });
            
            imageForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    showAuthModal();
                    return;
                }
                
                const title = document.getElementById('image-title').value.trim();
                const caption = document.getElementById('image-caption').value.trim();
                const tagsInput = document.getElementById('image-tags').value.trim();
                const allowComments = document.getElementById('image-comments').checked;
                const allowDownload = document.getElementById('image-download').checked;
                
                // Process tags
                const tags = tagsInput 
                    ? tagsInput.split(',').map(tag => tag.trim().replace(/^#/, '')).filter(tag => tag.length > 0) 
                    : [];
                
                if (!title || selectedFiles.length === 0) {
                    showToast('Please add a title and at least one image', 'error');
                    return;
                }
                
                // Limit file uploads
                if (selectedFiles.length > 10) {
                    showToast('Maximum 10 images allowed', 'error');
                    return;
                }
                
                // Show loading
                showLoading('Publishing post...');
                
                // Upload images to Firebase Storage
                const uploadPromises = [];
                const imageUrls = [];
                
                selectedFiles.forEach((file, index) => {
                    const storageRef = storage.ref(`posts/${currentUser.uid}/${Date.now()}-${index}-${file.name}`);
                    const uploadTask = storageRef.put(file);
                    
                    const uploadPromise = uploadTask
                        .then(() => storageRef.getDownloadURL())
                        .then(url => {
                            imageUrls.push(url);
                        });
                    
                    uploadPromises.push(uploadPromise);
                });
                
                // Get user info and wait for all uploads to complete
                Promise.all([
                    getUserInfo(currentUser.uid),
                    ...uploadPromises
                ])
                .then(([userInfo]) => {
                    // Add post to Firestore
                    return db.collection('posts').add({
                        userId: currentUser.uid,
                        userName: userInfo.name || 'User',
                        userImage: userInfo.profileImage || 'https://via.placeholder.com/40',
                        type: 'image',
                        title: title,
                        caption: caption,
                        imageUrls: imageUrls,
                        tags: tags,
                        allowComments: allowComments,
                        allowDownload: allowDownload,
                        likes: 0,
                        comments: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    hideLoading();
                    showToast('Image post published successfully!', 'success');
                    imageForm.reset();
                    imagePreviewContainer.innerHTML = '';
                    selectedFiles = [];
                    navigateToPage('home');
                    loadPosts(true); // Reload posts
                })
                .catch(error => {
                    hideLoading();
                    showToast('Error publishing post: ' + error.message, 'error');
                });
            });
            
            videoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    showAuthModal();
                    return;
                }
                
                const title = document.getElementById('video-title').value.trim();
                const description = document.getElementById('video-description').value.trim();
                const tagsInput = document.getElementById('video-tags').value.trim();
                const allowComments = document.getElementById('video-comments').checked;
                const allowDownload = document.getElementById('video-download').checked;
                const videoFile = videoUpload.files[0];
                
                // Process tags
                const tags = tagsInput 
                    ? tagsInput.split(',').map(tag => tag.trim().replace(/^#/, '')).filter(tag => tag.length > 0) 
                    : [];
                
                if (!title || !videoFile) {
                    showToast('Please add a title and video', 'error');
                    return;
                }
                
                if (!selectedThumbnailFile) {
                    showToast('Please select a thumbnail', 'error');
                    return;
                }
                
                // Limit video size (100MB)
                const maxSize = 100 * 1024 * 1024; // 100MB in bytes
                if (videoFile.size > maxSize) {
                    showToast('Video size exceeds 100MB limit', 'error');
                    return;
                }
                
                // Show loading
                showLoading('Publishing video...');
                
                // Get user info first
                getUserInfo(currentUser.uid).then(userInfo => {
                    // Upload thumbnail
                    const thumbnailRef = storage.ref(`thumbnails/${currentUser.uid}/${Date.now()}-${selectedThumbnailFile.name}`);
                    const thumbnailUpload = thumbnailRef.put(selectedThumbnailFile);
                    
                    return thumbnailUpload.then(() => {
                        return thumbnailRef.getDownloadURL().then(thumbnailUrl => {
                            // Upload video
                            const videoRef = storage.ref(`videos/${currentUser.uid}/${Date.now()}-${videoFile.name}`);
                            const videoUploadTask = videoRef.put(videoFile);
                            
                            return videoUploadTask.then(() => {
                                return videoRef.getDownloadURL().then(videoUrl => {
                                    // Add post to Firestore
                                    return db.collection('posts').add({
                                        userId: currentUser.uid,
                                        userName: userInfo.name || 'User',
                                        userImage: userInfo.profileImage || 'https://via.placeholder.com/40',
                                        type: 'video',
                                        title: title,
                                        description: description,
                                        videoUrl: videoUrl,
                                        thumbnailUrl: thumbnailUrl,
                                        tags: tags,
                                        allowComments: allowComments,
                                        allowDownload: allowDownload,
                                        likes: 0,
                                        comments: 0,
                                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            });
                        });
                    });
                })
                .then(() => {
                    hideLoading();
                    showToast('Video post published successfully!', 'success');
                    videoForm.reset();
                    videoPreviewContainer.classList.add('hidden');
                    thumbnailContainer.innerHTML = '';
                    videoPreview.src = '';
                    selectedThumbnailFile = null;
                    navigateToPage('home');
                    loadPosts(true); // Reload posts
                })
                .catch(error => {
                    hideLoading();
                    showToast('Error publishing post: ' + error.message, 'error');
                });
            });
            
            // Load posts from Firestore
            function loadPosts(refresh = false) {
                const postsContainer = document.getElementById('posts-container');
                const loadingElement = document.getElementById('posts-loading');
                const loadMoreContainer = document.getElementById('load-more-container');
                
                if (refresh) {
                    // Clear container but keep loading element
                    while (postsContainer.firstChild) {
                        if (postsContainer.firstChild.id === 'posts-loading') {
                            break;
                        }
                        postsContainer.removeChild(postsContainer.firstChild);
                    }
                    
                    // Reset pagination
                    lastDoc = null;
                }
                
                if (loadingElement) {
                    loadingElement.classList.remove('hidden');
                }
                
                loadMoreContainer.classList.add('hidden');
                
                let query = db.collection('posts')
                    .orderBy('createdAt', 'desc')
                    .limit(postsPerPage);
                
                if (lastDoc && !refresh) {
                    query = query.startAfter(lastDoc);
                }
                
                query.get()
                    .then(querySnapshot => {
                        if (loadingElement) {
                            loadingElement.classList.add('hidden');
                        }
                        
                        if (querySnapshot.empty) {
                            if (refresh || !document.querySelector('.post-card')) {
                                const noPostsMsg = document.createElement('p');
                                noPostsMsg.className = 'text-center py-10 text-gray-500';
                                noPostsMsg.textContent = 'No posts found.';
                                postsContainer.appendChild(noPostsMsg);
                            }
                            return;
                        }
                        
                        // Get the last document for pagination
                        lastDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
                        
                        // Show load more button if we got the full page of results
                        if (querySnapshot.docs.length >= postsPerPage) {
                            loadMoreContainer.classList.remove('hidden');
                        }
                        
                        // Process posts
                        querySnapshot.forEach(doc => {
                            const postData = doc.data();
                            const postId = doc.id;
                            
                            // Create post element with data already included
                            const postElement = createPostElement(postData, postId);
                            
                            // Add to container before loading element
                            if (loadingElement.parentNode === postsContainer) {
                                postsContainer.insertBefore(postElement, loadingElement);
                            } else {
                                postsContainer.appendChild(postElement);
                            }
                            
                            // Check if post is already liked by current user
                            if (currentUser) {
                                checkPostLikeStatus(postId, currentUser.uid, postElement);
                            }
                        });
                    })
                    .catch(error => {
                        console.error("Error loading posts: ", error);
                        if (loadingElement) {
                            loadingElement.classList.add('hidden');
                        }
                        
                        const errorMsg = document.createElement('p');
                        errorMsg.className = 'text-center py-10 text-red-500';
                        errorMsg.textContent = 'Error loading posts.';
                        postsContainer.appendChild(errorMsg);
                    });
            }
            
            // Check if user has liked a post
            function checkPostLikeStatus(postId, userId, postElement) {
                db.collection('posts').doc(postId)
                    .collection('likes').doc(userId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const likeBtn = postElement.querySelector('.like-btn');
                            if (likeBtn) {
                                const icon = likeBtn.querySelector('i');
                                icon.classList.remove('far');
                                icon.classList.add('fas', 'text-red-500');
                            }
                        }
                    })
                    .catch(error => {
                        console.error("Error checking like status: ", error);
                    });
            }
            
            // Load more posts when button is clicked
            document.getElementById('load-more').addEventListener('click', function() {
                loadPosts();
            });
            
            // Load user posts for profile page
            function loadUserPosts(userId) {
                const userPostsGrid = document.getElementById('user-posts-grid');
                const userPostsList = document.getElementById('user-posts-list');
                const loadingElement = document.getElementById('user-posts-loading');
                
                if (loadingElement) {
                    loadingElement.classList.remove('hidden');
                }
                
                db.collection('posts')
                    .where('userId', '==', userId)
                    .orderBy('createdAt', 'desc')
                    .get()
                    .then(querySnapshot => {
                        if (loadingElement) {
                            loadingElement.classList.add('hidden');
                        }
                        
                        if (querySnapshot.empty) {
                            userPostsGrid.innerHTML = '<p class="text-center py-10 text-gray-500 col-span-3">You haven\'t created any posts yet.</p>';
                            userPostsList.innerHTML = '<p class="text-center py-10 text-gray-500">You haven\'t created any posts yet.</p>';
                            document.getElementById('user-post-count').textContent = '0';
                            return;
                        }
                        
                        // Update post count
                        document.getElementById('user-post-count').textContent = querySnapshot.size;
                        
                        // Clear containers
                        userPostsGrid.innerHTML = '';
                        userPostsList.innerHTML = '';
                        
                        // Store post data
                        userPostData = [];
                        
                        // Process posts
                        querySnapshot.forEach(doc => {
                            const postData = doc.data();
                            const postId = doc.id;
                            userPostData.push({...postData, id: postId});
                            
                            // Grid view (just thumbnails)
                            const gridItem = createPostGridItem(postData, postId);
                            userPostsGrid.appendChild(gridItem);
                            
                            // List view (full post)
                            const listItem = createPostElement(postData, postId);
                            userPostsList.appendChild(listItem);
                        });
                    })
                    .catch(error => {
                        console.error("Error loading user posts: ", error);
                        if (loadingElement) {
                            loadingElement.classList.add('hidden');
                        }
                        userPostsGrid.innerHTML = '<p class="text-center py-10 text-red-500 col-span-3">Error loading posts.</p>';
                        userPostsList.innerHTML = '<p class="text-center py-10 text-red-500">Error loading posts.</p>';
                    });
            }
            
            // Create post grid item for profile page
            function createPostGridItem(postData, postId) {
                const gridItem = document.createElement('div');
                gridItem.className = 'aspect-square bg-gray-200 rounded-md overflow-hidden relative cursor-pointer';
                gridItem.dataset.postId = postId;
                
                // Add click handler to view post details
                gridItem.addEventListener('click', () => {
                    window.location.hash = `post/${postId}`;
                });
                
                let thumbnail;
                let overlayIcon = '';
                
                if (postData.type === 'image' && postData.imageUrls && postData.imageUrls.length > 0) {
                    thumbnail = postData.imageUrls[0];
                    
                    if (postData.imageUrls.length > 1) {
                        overlayIcon = '<div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-md p-1"><i class="fas fa-clone"></i></div>';
                    }
                } else if (postData.type === 'video' && postData.thumbnailUrl) {
                    thumbnail = postData.thumbnailUrl;
                    overlayIcon = '<div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-md p-1"><i class="fas fa-play"></i></div>';
                } else {
                    // Text post or missing thumbnail
                    gridItem.innerHTML = `
                        <div class="w-full h-full flex items-center justify-center bg-indigo-100 text-indigo-800">
                            <div class="p-4 text-center">
                                <i class="fas fa-font text-2xl mb-2"></i>
                                <p class="text-sm font-medium line-clamp-2">${postData.title || 'Post'}</p>
                            </div>
                        </div>
                    `;
                    return gridItem;
                }
                
                gridItem.innerHTML = `
                    <img src="${thumbnail}" alt="${postData.title || 'Post thumbnail'}" class="w-full h-full object-cover">
                    ${overlayIcon}
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2">
                        <p class="text-white text-xs font-medium truncate">${postData.title || ''}</p>
                        <div class="flex text-white text-xs mt-1">
                            <span class="mr-2"><i class="far fa-heart mr-1"></i>${postData.likes || 0}</span>
                            <span><i class="far fa-comment mr-1"></i>${postData.comments || 0}</span>
                        </div>
                    </div>
                `;
                
                return gridItem;
            }
            
            // Toggle between grid and list view on profile page
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            const userPostsGridView = document.getElementById('user-posts-grid');
            const userPostsListView = document.getElementById('user-posts-list');
            
            gridViewBtn.addEventListener('click', function() {
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                userPostsGridView.classList.remove('hidden');
                userPostsListView.classList.add('hidden');
            });
            
            listViewBtn.addEventListener('click', function() {
                listViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
                userPostsListView.classList.remove('hidden');
                userPostsGridView.classList.add('hidden');
            });
            
            // Create post element
            function createPostElement(postData, postId) {
                const postCard = document.createElement('div');
                postCard.className = 'card post-card';
                postCard.dataset.postId = postId;
                
                const postHeader = `
                    <div class="p-4">
                        <div class="flex items-center mb-4">
                            <img src="${postData.userImage || 'https://via.placeholder.com/40'}" alt="User profile" class="user-avatar mr-3 post-user-avatar">
                            <div>
                                <h3 class="font-semibold post-user-name">${postData.userName || 'User'}</h3>
                                <p class="text-gray-500 text-sm">${formatDate(postData.createdAt)}</p>
                            </div>
                            ${currentUser && currentUser.uid === postData.userId ? `
                                <button class="ml-auto text-gray-500 hover:text-gray-700 post-menu-btn" data-post-id="${postId}">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                            ` : ''}
                        </div>
                `;
                
                let postContent;
                
                // Different content based on post type
                if (postData.type === 'text') {
                    postContent = `
                        <div class="post-content">
                            <h3 class="text-xl font-semibold mb-2">${postData.title || ''}</h3>
                            <p>${postData.content || ''}</p>
                            ${postData.tags && postData.tags.length > 0 ? 
                                `<div class="flex flex-wrap mt-2">
                                    ${postData.tags.map(tag => `
                                        <span class="mr-2 mb-1 text-indigo-600 text-sm">#${tag}</span>
                                    `).join('')}
                                </div>` : 
                                ''}
                        </div>
                    `;
                } else if (postData.type === 'image') {
                    const imagesHtml = postData.imageUrls && postData.imageUrls.length > 0 ? 
                        `<div class="${postData.imageUrls.length > 1 ? 'grid grid-cols-1 md:grid-cols-2 gap-2' : ''} mb-4">
                            ${postData.imageUrls.map(url => `
                                <div class="rounded-lg overflow-hidden">
                                    <img src="${url}" alt="Post image" class="rounded-lg w-full ${postData.imageUrls.length === 1 ? 'post-image' : 'object-cover'}">
                                </div>
                            `).join('')}
                        </div>` : '';
                    
                    postContent = `
                        <div class="post-content">
                            <h3 class="text-xl font-semibold mb-2">${postData.title || ''}</h3>
                            ${imagesHtml}
                            <p>${postData.caption || ''}</p>
                            ${postData.tags && postData.tags.length > 0 ? 
                                `<div class="flex flex-wrap mt-2">
                                    ${postData.tags.map(tag => `
                                        <span class="mr-2 mb-1 text-indigo-600 text-sm">#${tag}</span>
                                    `).join('')}
                                </div>` : 
                                ''}
                        </div>
                    `;
                } else if (postData.type === 'video') {
                    postContent = `
                        <div class="post-content mb-4">
                            <h3 class="text-xl font-semibold mb-2">${postData.title || ''}</h3>
                            <div class="relative rounded-lg overflow-hidden mb-4">
                                <video controls playsinline webkit-playsinline poster="${postData.thumbnailUrl || ''}" class="w-full post-video">
                                    <source src="${postData.videoUrl}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            <p>${postData.description || ''}</p>
                            ${postData.tags && postData.tags.length > 0 ? 
                                `<div class="flex flex-wrap mt-2">
                                    ${postData.tags.map(tag => `
                                        <span class="mr-2 mb-1 text-indigo-600 text-sm">#${tag}</span>
                                    `).join('')}
                                </div>` : 
                                ''}
                        </div>
                    `;
                }
                
                const postActions = `
                    <div class="post-actions">
                        <button class="flex items-center text-gray-600 hover:text-indigo-600 like-btn" data-post-id="${postId}">
                            <i class="far fa-heart mr-1"></i> <span class="like-count">${postData.likes || 0}</span> Likes
                        </button>
                        <button class="flex items-center text-gray-600 hover:text-indigo-600 comment-btn" data-post-id="${postId}">
                            <i class="far fa-comment mr-1"></i> <span class="comment-count">${postData.comments || 0}</span> Comments
                        </button>
                        <button class="flex items-center text-gray-600 hover:text-indigo-600 share-btn" data-post-id="${postId}">
                            <i class="far fa-share-square mr-1"></i> Share
                        </button>
                    </div>
                `;
                
                const commentSection = postData.allowComments !== false ? `
                    <div class="comments-section p-4 border-t border-gray-100 hidden">
                        <h4 class="font-medium mb-2">Comments</h4>
                        <div class="comments-container" data-post-id="${postId}">
                            <div class="text-center py-3">
                                <div class="inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-indigo-600"></div>
                                <p class="mt-1 text-xs text-gray-500">Loading comments...</p>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex">
                                <img src="${currentUser ? (currentUser.photoURL || 'https://via.placeholder.com/40') : 'https://via.placeholder.com/40'}" alt="Your profile" class="w-8 h-8 rounded-full mr-3">
                                <div class="flex-1">
                                    <input type="text" placeholder="${currentUser ? 'Write a comment...' : 'Sign in to comment'}" class="comment-input w-full border border-gray-300 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" data-post-id="${postId}" ${currentUser ? '' : 'disabled'}>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : '';
                
                postCard.innerHTML = `
                    ${postHeader}
                    ${postContent}
                    </div>
                    ${postActions}
                    ${commentSection}
                `;
                
                // Add event listeners
                const likeBtn = postCard.querySelector('.like-btn');
                const commentBtn = postCard.querySelector('.comment-btn');
                const shareBtn = postCard.querySelector('.share-btn');
                const commentSection = postCard.querySelector('.comments-section');
                const commentInput = postCard.querySelector('.comment-input');
                const postMenuBtn = postCard.querySelector('.post-menu-btn');
                
                // Post menu (for post owner)
                if (postMenuBtn) {
                    postMenuBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        // Check if menu already exists
                        const existingMenu = document.querySelector('.post-menu');
                        if (existingMenu) {
                            existingMenu.remove();
                        }
                        
                        const menu = document.createElement('div');
                        menu.className = 'post-menu absolute right-0 bg-white rounded-md shadow-lg z-10';
                        menu.style.top = (e.target.offsetTop + 30) + 'px';
                        menu.style.right = '20px';
                        
                        menu.innerHTML = `
                            <div class="py-1">
                                <button class="edit-post-btn block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-post-id="${postId}">
                                    <i class="fas fa-edit mr-2"></i>Edit
                                </button>
                                <button class="delete-post-btn block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100" data-post-id="${postId}">
                                    <i class="fas fa-trash mr-2"></i>Delete
                                </button>
                            </div>
                        `;
                        
                        // Add to DOM
                        postCard.querySelector('.p-4').appendChild(menu);
                        
                        // Add click handlers
                        menu.querySelector('.edit-post-btn').addEventListener('click', function() {
                            // Implement edit post functionality
                            showToast('Edit functionality coming soon', 'info');
                            menu.remove();
                        });
                        
                        menu.querySelector('.delete-post-btn').addEventListener('click', function() {
                            if (confirm('Are you sure you want to delete this post?')) {
                                deletePost(postId, postData.type);
                            }
                            menu.remove();
                        });
                        
                        // Close menu when clicking elsewhere
                        document.addEventListener('click', function closeMenu(e) {
                            if (!menu.contains(e.target) && e.target !== postMenuBtn) {
                                menu.remove();
                                document.removeEventListener('click', closeMenu);
                            }
                        });
                    });
                }
                
                // Like button functionality
                if (likeBtn) {
                    likeBtn.addEventListener('click', function() {
                        if (!currentUser) {
                            showAuthModal();
                            return;
                        }
                        
                        const icon = this.querySelector('i');
                        const likeCountElem = this.querySelector('.like-count');
                        const isLiked = icon.classList.contains('fas');
                        
                        // Reference to the likes collection
                        const likeRef = db.collection('posts').doc(postId)
                            .collection('likes').doc(currentUser.uid);
                        
                        // Reference to the post document
                        const postRef = db.collection('posts').doc(postId);
                        
                        if (isLiked) {
                            // Unlike
                            icon.classList.remove('fas', 'text-red-500');
                            icon.classList.add('far');
                            
                            let likeCount = parseInt(likeCountElem.textContent);
                            likeCount = Math.max(0, likeCount - 1);
                            likeCountElem.textContent = likeCount;
                            
                            // Update in Firestore
                            db.runTransaction(transaction => {
                                return transaction.get(postRef).then(postDoc => {
                                    if (!postDoc.exists) {
                                        throw "Post does not exist!";
                                    }
                                    
                                    // Remove the like document
                                    transaction.delete(likeRef);
                                    
                                    // Update post likes count
                                    const newLikes = Math.max(0, (postDoc.data().likes || 0) - 1);
                                    transaction.update(postRef, { likes: newLikes });
                                });
                            }).catch(error => {
                                console.error("Error removing like: ", error);
                                
                                // Revert UI if transaction fails
                                icon.classList.remove('far');
                                icon.classList.add('fas', 'text-red-500');
                                likeCountElem.textContent = parseInt(likeCountElem.textContent) + 1;
                            });
                        } else {
                            // Like
                            icon.classList.remove('far');
                            icon.classList.add('fas', 'text-red-500');
                            
                            let likeCount = parseInt(likeCountElem.textContent);
                            likeCount++;
                            likeCountElem.textContent = likeCount;
                            
                            // Update in Firestore
                            db.runTransaction(transaction => {
                                return transaction.get(postRef).then(postDoc => {
                                    if (!postDoc.exists) {
                                        throw "Post does not exist!";
                                    }
                                    
                                    // Add the like document
                                    transaction.set(likeRef, { 
                                        userId: currentUser.uid,
                                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                    
                                    // Update post likes count
                                    const newLikes = (postDoc.data().likes || 0) + 1;
                                    transaction.update(post
                                    transaction.update(postRef, { likes: newLikes });
                                });
                            }).catch(error => {
                                console.error("Error adding like: ", error);
                                
                                // Revert UI if transaction fails
                                icon.classList.remove('fas', 'text-red-500');
                                icon.classList.add('far');
                                likeCountElem.textContent = parseInt(likeCountElem.textContent) - 1;
                            });
                        }
                    });
                }
                
                // Comment button functionality
                if (commentBtn) {
                    commentBtn.addEventListener('click', function() {
                        commentSection.classList.toggle('hidden');
                        
                        // Load comments if not already loaded
                        if (!commentSection.classList.contains('hidden')) {
                            loadComments(postId);
                        }
                    });
                }
                
                // Share button functionality
                if (shareBtn) {
                    shareBtn.addEventListener('click', function() {
                        if (navigator.share) {
                            navigator.share({
                                title: postData.title || 'Check out this post',
                                text: postData.content || postData.caption || postData.description || '',
                                url: window.location.origin + '/#post/' + postId
                            }).catch(err => {
                                console.error('Error sharing:', err);
                                showToast('Could not share post', 'error');
                            });
                        } else {
                            // Fallback for browsers that don't support Web Share API
                            const shareUrl = window.location.origin + '/#post/' + postId;
                            navigator.clipboard.writeText(shareUrl).then(() => {
                                showToast('Link copied to clipboard', 'success');
                            }).catch(err => {
                                console.error('Could not copy text: ', err);
                                showToast('Could not copy link', 'error');
                            });
                        }
                    });
                }
                
                // Comment input functionality
                if (commentInput) {
                    commentInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && this.value.trim()) {
                            addComment(postId, this.value.trim());
                            this.value = '';
                        }
                    });
                }
                
                return postCard;
            }
            
            // Load comments for a post
            function loadComments(postId) {
                const commentsContainer = document.querySelector(`.comments-container[data-post-id="${postId}"]`);
                
                if (!commentsContainer) return;
                
                db.collection('posts').doc(postId)
                    .collection('comments')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get()
                    .then(querySnapshot => {
                        commentsContainer.innerHTML = '';
                        
                        if (querySnapshot.empty) {
                            commentsContainer.innerHTML = '<p class="text-center py-3 text-gray-500 text-sm">No comments yet</p>';
                            return;
                        }
                        
                        querySnapshot.forEach(doc => {
                            const commentData = doc.data();
                            const commentElement = createCommentElement(commentData);
                            commentsContainer.appendChild(commentElement);
                        });
                    })
                    .catch(error => {
                        console.error("Error loading comments: ", error);
                        commentsContainer.innerHTML = '<p class="text-center py-3 text-red-500 text-sm">Error loading comments</p>';
                    });
            }
            
            // Create comment element
            function createCommentElement(commentData) {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                
                commentElement.innerHTML = `
                    <div class="flex">
                        <img src="${commentData.userImage || 'https://via.placeholder.com/40'}" alt="User profile" class="w-8 h-8 rounded-full mr-3">
                        <div>
                            <div class="bg-gray-100 rounded-lg p-3">
                                <h4 class="font-medium text-sm">${commentData.userName || 'User'}</h4>
                                <p class="text-gray-700 text-sm">${commentData.text}</p>
                            </div>
                            <p class="text-gray-500 text-xs mt-1">${formatDate(commentData.createdAt)}</p>
                        </div>
                    </div>
                `;
                
                return commentElement;
            }
            
            // Add a comment to a post
            function addComment(postId, commentText) {
                if (!currentUser) return;
                
                showLoading('Posting comment...');
                
                // Get user info first
                getUserInfo(currentUser.uid).then(userInfo => {
                    // Add comment to Firestore
                    return db.collection('posts').doc(postId)
                        .collection('comments').add({
                            userId: currentUser.uid,
                            userName: userInfo.name || 'User',
                            userImage: userInfo.profileImage || 'https://via.placeholder.com/40',
                            text: commentText,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                })
                .then(() => {
                    // Update comment count on the post
                    return db.collection('posts').doc(postId).update({
                        comments: firebase.firestore.FieldValue.increment(1)
                    });
                })
                .then(() => {
                    hideLoading();
                    showToast('Comment posted', 'success');
                    loadComments(postId); // Refresh comments
                    
                    // Update comment count in UI
                    const commentCountElem = document.querySelector(`.post-card[data-post-id="${postId}"] .comment-count`);
                    if (commentCountElem) {
                        const currentCount = parseInt(commentCountElem.textContent);
                        commentCountElem.textContent = currentCount + 1;
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('Error posting comment: ' + error.message, 'error');
                });
            }
            
            // Delete a post
            function deletePost(postId, postType) {
                showLoading('Deleting post...');
                
                // First delete the post document
                db.collection('posts').doc(postId).delete()
                    .then(() => {
                        // If it's an image post, delete the images from storage
                        if (postType === 'image') {
                            // You would need to store the storage references when uploading
                            // For now, we'll just delete the post document
                            hideLoading();
                            showToast('Post deleted', 'success');
                            loadPosts(true); // Refresh posts
                            loadUserPosts(currentUser.uid); // Refresh profile posts
                        } else if (postType === 'video') {
                            // Similarly for videos, delete from storage
                            hideLoading();
                            showToast('Post deleted', 'success');
                            loadPosts(true); // Refresh posts
                            loadUserPosts(currentUser.uid); // Refresh profile posts
                        } else {
                            // Text post - no storage to clean up
                            hideLoading();
                            showToast('Post deleted', 'success');
                            loadPosts(true); // Refresh posts
                            loadUserPosts(currentUser.uid); // Refresh profile posts
                        }
                    })
                    .catch(error => {
                        hideLoading();
                        showToast('Error deleting post: ' + error.message, 'error');
                    });
            }
            
            // Settings functionality
            settingsSaveBtn.addEventListener('click', function() {
                if (!currentUser) return;
                
                const name = document.getElementById('fullname').value.trim();
                const username = document.getElementById('username').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const bio = document.getElementById('bio').value.trim();
                
                const settings = {
                    allowComments: document.getElementById('allow-comments').checked,
                    tagNotifications: document.getElementById('tag-notifications').checked,
                    downloadPermission: document.getElementById('download-permission').checked,
                    emailNotifications: document.getElementById('email-notifications').checked,
                    pushNotifications: document.getElementById('push-notifications').checked,
                    marketingEmails: document.getElementById('marketing-emails').checked,
                    profileVisibility: document.getElementById('profile-visibility').value
                };
                
                showLoading('Saving settings...');
                
                // Update user profile in Firestore
                db.collection('users').doc(currentUser.uid).update({
                    name: name,
                    username: username,
                    phone: phone,
                    bio: bio,
                    settings: settings,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    // Update display name in Auth
                    return currentUser.updateProfile({
                        displayName: name
                    });
                })
                .then(() => {
                    hideLoading();
                    showToast('Settings saved successfully', 'success');
                    
                    // Update UI
                    document.getElementById('profile-user-name').textContent = name;
                    document.getElementById('profile-user-bio').textContent = bio || 'No bio yet';
                    document.getElementById('user-about').textContent = bio || 'No information provided.';
                })
                .catch(error => {
                    hideLoading();
                    showToast('Error saving settings: ' + error.message, 'error');
                });
            });
            
            settingsCancelBtn.addEventListener('click', function() {
                // Reload settings from Firestore
                if (currentUser) {
                    getUserProfile(currentUser.uid);
                }
            });
            
            // Reset password
            resetPasswordBtn.addEventListener('click', function() {
                if (!currentUser) {
                    showAuthModal();
                    return;
                }
                
                showLoading('Sending password reset email...');
                
                auth.sendPasswordResetEmail(currentUser.email)
                    .then(() => {
                        hideLoading();
                        showToast('Password reset email sent. Check your inbox.', 'success');
                    })
                    .catch(error => {
                        hideLoading();
                        showToast('Error sending reset email: ' + error.message, 'error');
                    });
            });
            
            // Delete account
            deleteAccountBtn.addEventListener('click', function() {
                deleteAccountModal.classList.remove('hidden');
            });
            
            cancelDeleteBtn.addEventListener('click', function() {
                deleteAccountModal.classList.add('hidden');
                document.getElementById('delete-password').value = '';
            });
            
            confirmDeleteBtn.addEventListener('click', function() {
                const password = document.getElementById('delete-password').value;
                
                if (!password) {
                    showToast('Please enter your password', 'error');
                    return;
                }
                
                showLoading('Deleting account...');
                
                // Reauthenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email, 
                    password
                );
                
                currentUser.reauthenticateWithCredential(credential)
                    .then(() => {
                        // Delete user from Auth
                        return currentUser.delete();
                    })
                    .then(() => {
                        // Delete user data from Firestore
                        return db.collection('users').doc(currentUser.uid).delete();
                    })
                    .then(() => {
                        hideLoading();
                        deleteAccountModal.classList.add('hidden');
                        document.getElementById('delete-password').value = '';
                        showToast('Account deleted successfully', 'success');
                    })
                    .catch(error => {
                        hideLoading();
                        showToast('Error deleting account: ' + error.message, 'error');
                    });
            });
            
            // Helper functions
            function getUserInfo(userId) {
                return db.collection('users').doc(userId).get()
                    .then(doc => {
                        if (doc.exists) {
                            return doc.data();
                        } else {
                            return {
                                name: 'User',
                                profileImage: 'https://via.placeholder.com/40'
                            };
                        }
                    })
                    .catch(error => {
                        console.error("Error getting user info: ", error);
                        return {
                            name: 'User',
                            profileImage: 'https://via.placeholder.com/40'
                        };
                    });
            }
            
            function formatDate(timestamp) {
                if (!timestamp) return '';
                
                const date = timestamp.toDate();
                const now = new Date();
                const diffInSeconds = Math.floor((now - date) / 1000);
                
                if (diffInSeconds < 60) {
                    return 'Just now';
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    return `${minutes} min ago`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                } else if (diffInSeconds < 604800) {
                    const days = Math.floor(diffInSeconds / 86400);
                    return `${days} day${days > 1 ? 's' : ''} ago`;
                } else {
                    return date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    });
                }
            }
            
            function showToast(message, type) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                // Remove toast after animation
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            function showLoading(message) {
                // You can implement a loading spinner here
                console.log('Loading:', message);
            }
            
            function hideLoading() {
                // Hide loading spinner
                console.log('Loading complete');
            }
            
            // Dark mode toggle
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // Check for saved theme preference or use system preference
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
                document.body.classList.add('dark-theme');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        document.body.classList.add('dark-theme');
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                    } else {
                        document.body.classList.remove('dark-theme');
                        themeIcon.classList.remove('fa-sun');
                        themeIcon.classList.add('fa-moon');
                    }
                }
            });
            
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
                
                if (document.body.classList.contains('dark-theme')) {
                    localStorage.setItem('theme', 'dark');
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    localStorage.setItem('theme', 'light');
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
            });
            
            // Initialize the app
            window.addEventListener('load', function() {
                // Check authentication state
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        // User is signed in
                        currentUser = user;
                        
                        // Load user profile
                        getUserProfile(user.uid);
                        
                        // Load user posts
                        loadUserPosts(user.uid);
                    } else {
                        // User is signed out
                        currentUser = null;
                    }
                    
                    // Load posts
                    loadPosts(true);
                });
            });
        });
    </script>
</body>
</html>
