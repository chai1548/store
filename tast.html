<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thailand 3D Lottery - ထိုင်း 3D ထီ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, getDocs, collection, addDoc, updateDoc, deleteDoc, serverTimestamp, query, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
         // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB49vRPX8YaWuTP5GS3lsBDqdAaz_hJYAw",
            authDomain: "onlineshop-849c8.firebaseapp.com",
            databaseURL: "https://onlineshop-849c8.firebaseio.com",
            projectId: "onlineshop-849c8",
            storageBucket: "onlineshop-849c8.appspot.com",
            messagingSenderId: "883512833370",
            appId: "1:883512833370:web:a1c8412b158f8744afef63"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.auth = auth;
        window.db = db;
        window.firebaseAuth = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged };
        window.firestore = { doc, setDoc, getDoc, getDocs, collection, addDoc, updateDoc, deleteDoc, serverTimestamp, query, where, orderBy, limit };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans Myanmar', sans-serif;
        }
        
        .lottery-ball {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .lottery-ball:hover {
            transform: scale(1.1);
        }
        
        .lottery-ball.selected {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }
        
        .admin-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .user-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .payment-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .lottery-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            margin: 8px 0;
        }
        
        .chat-user {
            background: #3B82F6;
            color: white;
            margin-left: auto;
        }
        
        .chat-ai {
            background: #F3F4F6;
            color: #374151;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-number {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10B981;
        }
        
        .notification.error {
            background: #EF4444;
        }
        
        .notification.warning {
            background: #F59E0B;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-dice text-blue-600 text-2xl mr-3"></i>
                    <span class="text-xl font-bold text-gray-800">Thailand 3D Lottery</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="languageBtn" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-language mr-1"></i>
                        <span id="currentLang">မြန်မာ</span>
                    </button>
                    <div id="userInfo" class="hidden items-center space-x-2">
                        <span id="userEmail" class="text-sm text-gray-600"></span>
                        <button id="logoutBtn" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                            <i class="fas fa-sign-out-alt mr-1"></i>
                            ထွက်ရန်
                        </button>
                    </div>
                    <div id="authButtons" class="flex space-x-2">
                        <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                            <i class="fas fa-sign-in-alt mr-1"></i>
                            ဝင်ရောက်ရန်
                        </button>
                        <button id="registerBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                            <i class="fas fa-user-plus mr-1"></i>
                            အကောင့်ဖွင့်ရန်
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ဝင်ရောက်ရန်</h3>
                    <button id="closeLoginModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">အီးမေးလ်</label>
                        <input type="email" id="loginEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">စကားဝှက်</label>
                        <input type="password" id="loginPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="flex items-center justify-between">
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">
                            ဝင်ရောက်ရန်
                        </button>
                    </div>
                </form>
                <div class="mt-4 text-center">
                    <button id="adminLoginBtn" class="text-purple-600 hover:text-purple-800 text-sm">
                        Admin အဖြစ် ဝင်ရောက်ရန်
                    </button>
                </div>
            </div>
        </div>

        <!-- Register Modal -->
        <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">အကောင့်ဖွင့်ရန်</h3>
                    <button id="closeRegisterModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="registerForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">အီးမေးလ်</label>
                        <input type="email" id="registerEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">စကားဝှက်</label>
                        <input type="password" id="registerPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">ဖုန်းနံပါတ်</label>
                        <input type="tel" id="registerPhone" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">နာမည်</label>
                        <input type="text" id="registerName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="flex items-center justify-between">
                        <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">
                            အကောင့်ဖွင့်ရန်
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-purple-600">Admin Login</h3>
                    <button id="closeAdminLoginModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="adminLoginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Admin Email</label>
                        <input type="email" id="adminEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" value="admin@thailottery.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Admin Password</label>
                        <input type="password" id="adminPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" value="Admin123!@#">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Admin Secret Key</label>
                        <input type="password" id="adminSecret" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="THAI_LOTTERY_ADMIN_2024">
                    </div>
                    <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 w-full">
                        Admin ဝင်ရောက်ရန်
                    </button>
                </form>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="user-card rounded-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-users text-3xl mr-4"></i>
                        <div>
                            <p class="text-sm opacity-80">စုစုပေါင်း အသုံးပြုသူများ</p>
                            <p id="totalUsers" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="lottery-card rounded-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-ticket-alt text-3xl mr-4"></i>
                        <div>
                            <p class="text-sm opacity-80">ယခုလ ထီလက်မှတ်</p>
                            <p id="monthlyTickets" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="payment-card rounded-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-coins text-3xl mr-4"></i>
                        <div>
                            <p class="text-sm opacity-80">စုစုပေါင်း ရသုံးငွေ</p>
                            <p id="totalRevenue" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="admin-card rounded-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-3xl mr-4"></i>
                        <div>
                            <p class="text-sm opacity-80">ယနေ့ လုပ်ငန်း</p>
                            <p id="todayActivity" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Tabs -->
            <div class="bg-white rounded-lg shadow-lg">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8" aria-label="Tabs">
                        <button class="tab-btn py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600" data-tab="lottery">
                            <i class="fas fa-dice mr-2"></i>
                            ထီဝယ်ရန်
                        </button>
                        <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="payment">
                            <i class="fas fa-wallet mr-2"></i>
                            ငွေကြေး
                        </button>
                        <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="results">
                            <i class="fas fa-trophy mr-2"></i>
                            ရလဒ်များ
                        </button>
                        <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="history">
                            <i class="fas fa-history mr-2"></i>
                            မှတ်တမ်း
                        </button>
                        <button class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ai">
                            <i class="fas fa-robot mr-2"></i>
                            AI အကူအညီ
                        </button>
                        <button id="adminTab" class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-purple-500 hover:text-purple-700 hover:border-purple-300 hidden" data-tab="admin">
                            <i class="fas fa-cog mr-2"></i>
                            Admin Panel
                        </button>
                    </nav>
                </div>

                <!-- Lottery Tab -->
                <div id="lottery" class="tab-content p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4">3D နံပါတ် ရွေးချယ်ပါ</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ပထမဂဏန်း (0-9)</label>
                                    <div id="firstDigit" class="flex space-x-2">
                                        <!-- Numbers 0-9 will be generated here -->
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ဒုတိယဂဏန်း (0-9)</label>
                                    <div id="secondDigit" class="flex space-x-2">
                                        <!-- Numbers 0-9 will be generated here -->
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">တတိယဂဏန်း (0-9)</label>
                                    <div id="thirdDigit" class="flex space-x-2">
                                        <!-- Numbers 0-9 will be generated here -->
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ငွေပမာណ (ကျပ်)</label>
                                <input type="number" id="betAmount" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="100" placeholder="အနည်းဆုံး ၁၀၀ ကျပ်">
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">ရွေးချယ်ထားသော နံပါတ်</h3>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="text-center mb-4">
                                    <div class="text-4xl font-bold text-blue-600" id="selectedNumber">---</div>
                                    <div class="text-sm text-gray-600 mt-2">ရွေးချယ်ထားသော 3D နံပါတ်</div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>ငွေပမာណ:</span>
                                        <span id="displayAmount" class="font-bold">0 ကျပ်</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>ဖြစ်နိုင်သော ဆုငွေ:</span>
                                        <span id="potentialWin" class="font-bold text-green-600">0 ကျပ်</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>ထွက်ပွဲရက်:</span>
                                        <span id="drawDate" class="font-bold">--/--/----</span>
                                    </div>
                                </div>
                                <button id="buyTicketBtn" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 mt-4 disabled:bg-gray-300 disabled:cursor-not-allowed">
                                    <i class="fas fa-shopping-cart mr-2"></i>
                                    ထီလက်မှတ် ဝယ်ယူရန်
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Tab -->
                <div id="payment" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4">ငွေသွင်းရန်</h3>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ငွေပမာណ</label>
                                    <input type="number" id="depositAmount" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="1000" placeholder="အနည်းဆုံး ၁၀၀၀ ကျပ်">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ငွေပေးချေမှု နည်းလမ်း</label>
                                    <select id="paymentMethod" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                        <option value="">ရွေးချယ်ပါ</option>
                                        <option value="kpay">KBZ Pay</option>
                                        <option value="wavepay">Wave Pay</option>
                                        <option value="ayapay">AYA Pay</option>
                                        <option value="cbpay">CB Pay</option>
                                        <option value="bank">ဘဏ်လွှဲငွေ</option>
                                    </select>
                                </div>
                                <button id="depositBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
                                    <i class="fas fa-plus-circle mr-2"></i>
                                    ငွေသွင်းရန်
                                </button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">ငွေထုတ်ရန်</h3>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ပိုက်ဆံအိတ် လက်ကျန်</label>
                                    <div class="text-2xl font-bold text-green-600" id="walletBalance">0 ကျပ်</div>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ထုတ်လိုသော ငွေပမာণ</label>
                                    <input type="number" id="withdrawAmount" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="1000" placeholder="အနည်းဆုံး ၁၀၀၀ ကျပ်">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ဘဏ်အကောင့် / ဖုန်းနံပါတ်</label>
                                    <input type="text" id="withdrawAccount" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="ငွေလက်ခံရန် အကောင့်">
                                </div>
                                <button id="withdrawBtn" class="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600">
                                    <i class="fas fa-minus-circle mr-2"></i>
                                    ငွေထုတ်ရန်
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-xl font-bold mb-4">ငွေကြေး လုပ်ငန်းမှတ်တမ်း</h3>
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">နေ့စွဲ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">အမျိုးအစား</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ငွေပမာណ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">အခြေအနေ</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionHistory" class="bg-white divide-y divide-gray-200">
                                    <!-- Transaction history will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Results Tab -->
                <div id="results" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4">ယခုလ ထီရလဒ်</h3>
                            <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-lg p-8 text-white text-center">
                                <div class="text-lg mb-2">လာမည့် ထွက်ပွဲ</div>
                                <div id="nextDrawDate" class="text-2xl font-bold mb-4">၂၀၂၄ ခုနှစ်၊ ဇန်နဝါရီလ ၃၀ ရက်</div>
                                <div class="text-sm opacity-80">ညနေ ၆:၀၀ နာရီတွင် ထွက်ပါမည်</div>
                            </div>
                            <div class="mt-6">
                                <h4 class="text-lg font-bold mb-3">ယခင်လ ရလဒ်များ</h4>
                                <div id="previousResults" class="space-y-3">
                                    <!-- Previous results will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">ရလဒ် စစ်ဆေးရန်</h3>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ထီလက်မှတ် နံပါတ်</label>
                                    <input type="text" id="checkTicketNumber" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="XXX နံပါတ် ထည့်ပါ">
                                </div>
                                <button id="checkResultBtn" class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 mb-4">
                                    <i class="fas fa-search mr-2"></i>
                                    ရလဒ်စစ်ရန်
                                </button>
                                <div id="checkResult" class="hidden">
                                    <div class="border-t pt-4">
                                        <div class="text-center">
                                            <div id="resultStatus" class="text-lg font-bold mb-2"></div>
                                            <div id="winAmount" class="text-2xl font-bold text-green-600"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6">
                                <h4 class="text-lg font-bold mb-3">ဆုငွေ ဇယား</h4>
                                <div class="bg-white border rounded-lg overflow-hidden">
                                    <table class="min-w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">အမျိုးအစား</th>
                                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">ဆုငွေ</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            <tr>
                                                <td class="px-4 py-2 text-sm">လက်မှတ်နံပါတ် အတိအကျ ကိုက်ညီ</td>
                                                <td class="px-4 py-2 text-sm font-bold text-green-600">x500</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-2 text-sm">နောက်ဆုံး ၂ လုံး ကိုက်ညီ</td>
                                                <td class="px-4 py-2 text-sm font-bold text-green-600">x50</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-2 text-sm">နောက်ဆုံး ၁ လုံး ကိုက်ညီ</td>
                                                <td class="px-4 py-2 text-sm font-bold text-green-600">x5</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div id="history" class="tab-content p-6 hidden">
                    <h3 class="text-xl font-bold mb-4">ထီလက်မှတ် မှတ်တမ်း</h3>
                    <div class="bg-white border rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">နေ့စွဲ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">နံပါတ်</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ငွေပမာณ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">အခြေအနေ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ဆုငွေ</th>
                                </tr>
                            </thead>
                            <tbody id="ticketHistory" class="bg-white divide-y divide-gray-200">
                                <!-- Ticket history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- AI Tab -->
                <div id="ai" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4">AI အကူအညီ</h3>
                            <div class="bg-gray-50 rounded-lg p-4 h-96 overflow-y-auto mb-4" id="chatMessages">
                                <div class="chat-bubble chat-ai">
                                    မင်္ဂလာပါ! ကျွန်ုပ်သည် Thailand 3D Lottery AI Assistant ဖြစ်ပါသည်။ သင့်ကို ဘယ်လို ကူညီနိုင်ပါသလဲ?
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <input type="text" id="chatInput" class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="မေးခွန်းတစ်ခု မေးပါ...">
                                <button id="sendChatBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">AI နံပါတ် ခန့်မှန်းချက်</h3>
                            <div class="bg-gradient-to-r from-blue-400 to-purple-500 rounded-lg p-6 text-white mb-4">
                                <h4 class="text-lg font-bold mb-3">ယနေ့အတွက် AI ရွေးချယ်ချက်</h4>
                                <div class="flex justify-center space-x-4 mb-4">
                                    <div class="lottery-ball bg-white text-gray-800" id="aiNumber1">?</div>
                                    <div class="lottery-ball bg-white text-gray-800" id="aiNumber2">?</div>
                                    <div class="lottery-ball bg-white text-gray-800" id="aiNumber3">?</div>
                                </div>
                                <div class="text-center">
                                    <button id="generateAINumbers" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100">
                                        <i class="fas fa-magic mr-2"></i>
                                        AI ခန့်မှန်းချက် ရယူရန်
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-white border rounded-lg p-4">
                                    <h5 class="font-bold mb-2">
                                        <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                                        ဈေးကွက် ခွဲခြမ်းစိတ်ဖြာမှု
                                    </h5>
                                    <canvas id="analysisChart" width="400" height="200"></canvas>
                                </div>
                                <div class="bg-white border rounded-lg p-4">
                                    <h5 class="font-bold mb-2">
                                        <i class="fas fa-tips text-green-500 mr-2"></i>
                                        AI အကြံပြုချက်များ
                                    </h5>
                                    <ul id="aiTips" class="text-sm text-gray-600 space-y-1">
                                        <li>• ထီဝယ်ယူရာတွင် ပိုက်ဆံ စီမံခန့်ခွဲမှု အရေးကြီးပါသည်</li>
                                        <li>• အတိတ် ရလဒ်များကို လေ့လာပါ</li>
                                        <li>• စိတ်ကူး လက္ခဏာများကို မှီခိုမနေပါနှင့်</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Panel -->
                <div id="admin" class="tab-content p-6 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="admin-card rounded-lg p-6">
                            <h4 class="text-lg font-bold mb-4">အသုံးပြုသူ စီမံခန့်ခွဲမှု</h4>
                            <div class="space-y-3">
                                <button class="admin-btn w-full bg-white text-purple-600 py-2 rounded hover:bg-gray-100" onclick="showUserManagement()">
                                    <i class="fas fa-users mr-2"></i>
                                    အသုံးပြုသူများကို ကြည့်ရန်
                                </button>
                                <button class="admin-btn w-full bg-white text-purple-600 py-2 rounded hover:bg-gray-100" onclick="showUserStats()">
                                    <i class="fas fa-chart-bar mr-2"></i>
                                    အင်ကျဉ်းဇယား
                                </button>
                            </div>
                        </div>
                        <div class="payment-card rounded-lg p-6">
                            <h4 class="text-lg font-bold mb-4">ငွေကြေး စီမံခန့်ခွဲမှု</h4>
                            <div class="space-y-3">
                                <button class="admin-btn w-full bg-white text-blue-600 py-2 rounded hover:bg-gray-100" onclick="showPendingDeposits()">
                                    <i class="fas fa-clock mr-2"></i>
                                    စောင့်ဆိုင်းနေသော ငွေသွင်းမှုများ
                                </button>
                                <button class="admin-btn w-full bg-white text-blue-600 py-2 rounded hover:bg-gray-100" onclick="showPendingWithdrawals()">
                                    <i class="fas fa-money-bill-wave mr-2"></i>
                                    စောင့်ဆိုင်းနေသော ငွေထုတ်မှုများ
                                </button>
                            </div>
                        </div>
                        <div class="lottery-card rounded-lg p-6">
                            <h4 class="text-lg font-bold mb-4">ထီ စီမံခန့်ခွဲမှု</h4>
                            <div class="space-y-3">
                                <button class="admin-btn w-full bg-white text-green-600 py-2 rounded hover:bg-gray-100" onclick="createNewDraw()">
                                    <i class="fas fa-plus mr-2"></i>
                                    ထွက်ပွဲအသစ် ဖန်တီးရန်
                                </button>
                                <button class="admin-btn w-full bg-white text-green-600 py-2 rounded hover:bg-gray-100" onclick="announceResults()">
                                    <i class="fas fa-bullhorn mr-2"></i>
                                    ရလဒ် ကြေညာရန်
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Content Area -->
                    <div id="adminContent" class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Admin Dashboard</h3>
                        <p class="text-gray-600">အပေါ်က button များမှ လုပ်ငန်းများကို ရွေးချယ်ပါ။</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Welcome Section (for non-logged in users) -->
        <div id="welcomeSection">
            <div class="text-center py-12">
                <i class="fas fa-dice text-6xl text-blue-600 mb-4"></i>
                <h1 class="text-4xl font-bold text-gray-800 mb-4">Thailand 3D Lottery</h1>
                <p class="text-xl text-gray-600 mb-8">မြန်မာနိုင်ငံမှ ထိုင်း 3D ထီ ဝယ်ယူနိုင်သော နံပါတ်တစ် Website</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <i class="fas fa-shield-alt text-3xl text-green-500 mb-3"></i>
                        <h3 class="text-lg font-bold mb-2">လုံခြုံမှု</h3>
                        <p class="text-gray-600">Firebase နှင့် လုံခြုံသော ငွေကြေးလုပ်ငန်း</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <i class="fas fa-mobile-alt text-3xl text-blue-500 mb-3"></i>
                        <h3 class="text-lg font-bold mb-2">လွယ်ကူမှု</h3>
                        <p class="text-gray-600">မိုဘိုင်းဖုန်းဖြင့် အလွယ်တကူ အသုံးပြုနိုင်</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <i class="fas fa-robot text-3xl text-purple-500 mb-3"></i>
                        <h3 class="text-lg font-bold mb-2">AI အကူအညီ</h3>
                        <p class="text-gray-600">AI နှင့် နံပါတ် ခန့်မှန်းချက်များ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">ကျေးဇူးပြု၍ စောင့်ပါ...</p>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let selectedNumbers = { first: null, second: null, third: null };
        let currentLang = 'my';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            generateNumberPads();
            setupEventListeners();
            loadDemoData();
        });

        function initializeApp() {
            // Auth state observer
            window.firebaseAuth.onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    currentUser = user;
                    showDashboard();
                    loadUserData();
                } else {
                    currentUser = null;
                    showWelcome();
                }
            });
        }

        function generateNumberPads() {
            const containers = ['firstDigit', 'secondDigit', 'thirdDigit'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                for (let i = 0; i <= 9; i++) {
                    const ball = document.createElement('div');
                    ball.className = 'lottery-ball';
                    ball.textContent = i;
                    ball.onclick = () => selectNumber(containerId, i);
                    container.appendChild(ball);
                }
            });
        }

        function selectNumber(position, number) {
            // Clear previous selection
            document.querySelectorAll(`#${position} .lottery-ball`).forEach(ball => {
                ball.classList.remove('selected');
            });
            
            // Select new number
            event.target.classList.add('selected');
            
            // Update selected numbers
            if (position === 'firstDigit') selectedNumbers.first = number;
            if (position === 'secondDigit') selectedNumbers.second = number;
            if (position === 'thirdDigit') selectedNumbers.third = number;
            
            updateSelectedDisplay();
        }

        function updateSelectedDisplay() {
            const { first, second, third } = selectedNumbers;
            const display = document.getElementById('selectedNumber');
            const amountInput = document.getElementById('betAmount');
            const amount = parseInt(amountInput.value) || 0;
            
            if (first !== null && second !== null && third !== null) {
                display.textContent = `${first}${second}${third}`;
                document.getElementById('displayAmount').textContent = `${amount.toLocaleString()} ကျပ်`;
                document.getElementById('potentialWin').textContent = `${(amount * 500).toLocaleString()} ကျပ်`;
                document.getElementById('buyTicketBtn').disabled = amount < 100;
            } else {
                display.textContent = '---';
                document.getElementById('displayAmount').textContent = '0 ကျပ်';
                document.getElementById('potentialWin').textContent = '0 ကျပ်';
                document.getElementById('buyTicketBtn').disabled = true;
            }
            
            // Set next draw date (last day of current month)
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            document.getElementById('drawDate').textContent = formatDate(nextMonth);
        }

        function setupEventListeners() {
            // Auth buttons
            document.getElementById('loginBtn').onclick = () => showModal('loginModal');
            document.getElementById('registerBtn').onclick = () => showModal('registerModal');
            document.getElementById('adminLoginBtn').onclick = () => showModal('adminLoginModal');
            document.getElementById('logoutBtn').onclick = logout;

            // Modal close buttons
            document.getElementById('closeLoginModal').onclick = () => hideModal('loginModal');
            document.getElementById('closeRegisterModal').onclick = () => hideModal('registerModal');
            document.getElementById('closeAdminLoginModal').onclick = () => hideModal('adminLoginModal');

            // Forms
            document.getElementById('loginForm').onsubmit = handleLogin;
            document.getElementById('registerForm').onsubmit = handleRegister;
            document.getElementById('adminLoginForm').onsubmit = handleAdminLogin;

            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.onclick = () => switchTab(btn.dataset.tab);
            });

            // Lottery functionality
            document.getElementById('betAmount').oninput = updateSelectedDisplay;
            document.getElementById('buyTicketBtn').onclick = buyTicket;

            // Payment functionality
            document.getElementById('depositBtn').onclick = handleDeposit;
            document.getElementById('withdrawBtn').onclick = handleWithdraw;

            // Results functionality
            document.getElementById('checkResultBtn').onclick = checkTicketResult;

            // AI functionality
            document.getElementById('sendChatBtn').onclick = sendChatMessage;
            document.getElementById('chatInput').onkeypress = (e) => {
                if (e.key === 'Enter') sendChatMessage();
            };
            document.getElementById('generateAINumbers').onclick = generateAINumbers;

            // Language toggle
            document.getElementById('languageBtn').onclick = toggleLanguage;
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                showLoading(true);
                await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                hideModal('loginModal');
                showNotification('အောင်မြင်စွာ ဝင်ရောက်ပါပြီ!', 'success');
            } catch (error) {
                showNotification('ဝင်ရောက်ရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;
            const name = document.getElementById('registerName').value;

            try {
                showLoading(true);
                const userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(window.auth, email, password);
                
                // Save user data to Firestore
                await window.firestore.setDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid), {
                    email: email,
                    name: name,
                    phone: phone,
                    role: 'user',
                    balance: 0,
                    createdAt: window.firestore.serverTimestamp(),
                    isActive: true
                });

                hideModal('registerModal');
                showNotification('အကောင့်ဖွင့်ခြင်း အောင်မြင်ပါပြီ!', 'success');
            } catch (error) {
                showNotification('အကောင့်ဖွင့်ရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const secret = document.getElementById('adminSecret').value;

            if (secret !== 'THAI_LOTTERY_ADMIN_2024') {
                showNotification('Admin Secret Key မှားယွင်းပါသည်', 'error');
                return;
            }

            try {
                showLoading(true);
                
                // For demo purposes, create admin user if doesn't exist
                if (email === 'admin@thailottery.com') {
                    try {
                        await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                    } catch (error) {
                        // Create admin user if doesn't exist
                        const userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(window.auth, email, password);
                        await window.firestore.setDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid), {
                            email: email,
                            name: 'Super Admin',
                            role: 'admin',
                            permissions: {
                                manageUsers: true,
                                manageLottery: true,
                                managePayments: true,
                                viewReports: true,
                                manageSystem: true
                            },
                            createdAt: window.firestore.serverTimestamp(),
                            isActive: true
                        });
                    }
                } else {
                    await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                }

                hideModal('adminLoginModal');
                showNotification('Admin အဖြစ် ဝင်ရောက်ပါပြီ!', 'success');
            } catch (error) {
                showNotification('Admin login မှားယွင်းပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function logout() {
            try {
                await window.firebaseAuth.signOut(window.auth);
                showNotification('အောင်မြင်စွာ ထွက်ပါပြီ!', 'success');
            } catch (error) {
                showNotification('ထွက်ရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            }
        }

        function showDashboard() {
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('flex');
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userEmail').textContent = currentUser.email;
        }

        function showWelcome() {
            document.getElementById('welcomeSection').style.display = 'block';
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('flex');
            document.getElementById('authButtons').style.display = 'flex';
        }

        async function loadUserData() {
            if (!currentUser) return;

            try {
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', currentUser.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    
                    // Show admin tab if user is admin
                    if (userData.role === 'admin') {
                        document.getElementById('adminTab').classList.remove('hidden');
                    }
                    
                    // Update wallet balance
                    document.getElementById('walletBalance').textContent = `${(userData.balance || 0).toLocaleString()} ကျပ်`;
                    
                    // Load user transactions and tickets
                    loadTransactionHistory();
                    loadTicketHistory();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-blue-500', 'text-blue-600');

            // Show/hide tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabName).classList.remove('hidden');
        }

        async function buyTicket() {
            if (!currentUser) {
                showNotification('ကျေးဇူးပြု၍ အရင် ဝင်ရောက်ပါ', 'warning');
                return;
            }

            const { first, second, third } = selectedNumbers;
            const amount = parseInt(document.getElementById('betAmount').value);

            if (first === null || second === null || third === null) {
                showNotification('ကျေးဇူးပြု၍ 3D နံပါတ် အပြည့်အစုံ ရွေးချယ်ပါ', 'warning');
                return;
            }

            if (amount < 100) {
                showNotification('အနည်းဆုံး ၁၀၀ ကျပ် လိုအပ်ပါသည်', 'warning');
                return;
            }

            try {
                showLoading(true);
                
                // Check user balance
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', currentUser.uid));
                const userData = userDoc.data();
                
                if ((userData.balance || 0) < amount) {
                    showNotification('ပိုက်ဆံအိတ်တွင် ငွေမလုံလောက်ပါ', 'error');
                    return;
                }

                // Create ticket
                const ticketNumber = `${first}${second}${third}`;
                await window.firestore.addDoc(window.firestore.collection(window.db, 'tickets'), {
                    userId: currentUser.uid,
                    ticketNumber: ticketNumber,
                    amount: amount,
                    drawDate: getNextDrawDate(),
                    status: 'active',
                    createdAt: window.firestore.serverTimestamp()
                });

                // Update user balance
                await window.firestore.updateDoc(window.firestore.doc(window.db, 'users', currentUser.uid), {
                    balance: (userData.balance || 0) - amount
                });

                // Reset form
                selectedNumbers = { first: null, second: null, third: null };
                document.getElementById('betAmount').value = '';
                document.querySelectorAll('.lottery-ball').forEach(ball => ball.classList.remove('selected'));
                updateSelectedDisplay();

                showNotification('ထီလက်မှတ် ဝယ်ယူခြင်း အောင်မြင်ပါပြီ!', 'success');
                loadUserData();
                loadTicketHistory();
            } catch (error) {
                showNotification('ထီလက်မှတ် ဝယ်ယူရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            const method = document.getElementById('paymentMethod').value;

            if (!amount || amount < 1000) {
                showNotification('အနည်းဆုံး ၁၀၀၀ ကျပ် လိုအပ်ပါသည်', 'warning');
                return;
            }

            if (!method) {
                showNotification('ငွေပေးချေမှု နည်းလမ်း ရွေးချယ်ပါ', 'warning');
                return;
            }

            try {
                showLoading(true);
                
                // Create deposit request
                await window.firestore.addDoc(window.firestore.collection(window.db, 'transactions'), {
                    userId: currentUser.uid,
                    type: 'deposit',
                    amount: amount,
                    method: method,
                    status: 'pending',
                    createdAt: window.firestore.serverTimestamp()
                });

                document.getElementById('depositAmount').value = '';
                document.getElementById('paymentMethod').value = '';

                showNotification('ငွေသွင်းတောင်းဆိုမှု ပေးပို့ပါပြီ! Admin မှ ခွင့်ပြုချက်ရပါမည်', 'success');
                loadTransactionHistory();
            } catch (error) {
                showNotification('ငွေသွင်းရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleWithdraw() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const account = document.getElementById('withdrawAccount').value;

            if (!amount || amount < 1000) {
                showNotification('အနည်းဆုံး ၁၀၀၀ ကျပ် လိုအပ်ပါသည်', 'warning');
                return;
            }

            if (!account) {
                showNotification('ငွေလက်ခံရန် အကောင့် ထည့်ပါ', 'warning');
                return;
            }

            try {
                showLoading(true);
                
                // Check balance
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', currentUser.uid));
                const userData = userDoc.data();
                
                if ((userData.balance || 0) < amount) {
                    showNotification('ပိုက်ဆံအိတ်တွင် ငွေမလုံလောက်ပါ', 'error');
                    return;
                }

                // Create withdraw request
                await window.firestore.addDoc(window.firestore.collection(window.db, 'transactions'), {
                    userId: currentUser.uid,
                    type: 'withdraw',
                    amount: amount,
                    account: account,
                    status: 'pending',
                    createdAt: window.firestore.serverTimestamp()
                });

                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawAccount').value = '';

                showNotification('ငွေထုတ်တောင်းဆိုမှု ပေးပို့ပါပြီ! Admin မှ ခွင့်ပြုချက်ရပါမည်', 'success');
                loadTransactionHistory();
            } catch (error) {
                showNotification('ငွေထုတ်ရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function checkTicketResult() {
            const ticketNumber = document.getElementById('checkTicketNumber').value;
            
            if (!ticketNumber || ticketNumber.length !== 3) {
                showNotification('ကျေးဇူးပြု၍ 3 လုံး နံပါတ် ထည့်ပါ', 'warning');
                return;
            }

            try {
                showLoading(true);
                
                // Simulate result checking (in real app, this would check against actual results)
                const randomWin = Math.random() < 0.1; // 10% chance to win
                const resultDiv = document.getElementById('checkResult');
                const statusDiv = document.getElementById('resultStatus');
                const winAmountDiv = document.getElementById('winAmount');
                
                if (randomWin) {
                    statusDiv.textContent = 'ဂုဏ်ယူပါသည်! သင် ပေါက်ပါပြီ!';
                    statusDiv.className = 'text-lg font-bold mb-2 text-green-600';
                    winAmountDiv.textContent = '50,000 ကျပ်';
                } else {
                    statusDiv.textContent = 'စိတ်မရှုပ်ပါနှင့်! နောက်တစ်ကြိမ် ကံစမ်းကြည့်ပါ';
                    statusDiv.className = 'text-lg font-bold mb-2 text-red-600';
                    winAmountDiv.textContent = '0 ကျပ်';
                }
                
                resultDiv.classList.remove('hidden');
            } catch (error) {
                showNotification('ရလဒ်စစ်ရာတွင် အမှားအယွင်း ဖြစ်ပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesContainer = document.getElementById('chatMessages');
            
            // Add user message
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble chat-user ml-auto';
            userBubble.textContent = message;
            messagesContainer.appendChild(userBubble);
            
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const aiBubble = document.createElement('div');
                aiBubble.className = 'chat-bubble chat-ai';
                aiBubble.textContent = getAIResponse(message);
                messagesContainer.appendChild(aiBubble);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getAIResponse(message) {
            const responses = [
                'ထီဝယ်ယူရာတွင် ပိုက်ဆံ စီမံခန့်ခွဲမှု အရေးကြီးပါသည်။ အရှုံးခံနိုင်သမျှသာ ဝယ်ယူပါ။',
                'Thailand 3D Lottery သည် လစဉ် ထွက်ပွဲရှိပြီး ဆုငွေ အများကြီး ရရှိနိုင်ပါသည်။',
                'AI ခန့်မှန်းချက်များသည် ရာဇဝင် ဒေတာများကို အခြေခံ၍ တွက်ချက်ထားပါသည်။',
                'ပိုမို အောင်မြင်လိုပါက နံပါတ်များ၏ ပုံစံများကို လေ့လာပါ။',
                'ငွေကြေး လုပ်ငန်းများတွင် အခက်အခဲရှိပါက Admin နှင့် ဆက်သွယ်ပါ။'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateAINumbers() {
            // Simulate AI number generation
            const numbers = [];
            for (let i = 0; i < 3; i++) {
                numbers.push(Math.floor(Math.random() * 10));
            }
            
            document.getElementById('aiNumber1').textContent = numbers[0];
            document.getElementById('aiNumber2').textContent = numbers[1];
            document.getElementById('aiNumber3').textContent = numbers[2];
            
            showNotification('AI နံပါတ်များ ထုတ်ပြီးပါပြီ!', 'success');
        }

        async function loadTransactionHistory() {
            if (!currentUser) return;
            
            try {
                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'transactions'),
                    window.firestore.where('userId', '==', currentUser.uid),
                    window.firestore.orderBy('createdAt', 'desc'),
                    window.firestore.limit(10)
                );
                
                const snapshot = await window.firestore.getDocs(q);
                const tbody = document.getElementById('transactionHistory');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(new Date())}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${data.type === 'deposit' ? 'ငွေသွင်း' : 'ငွေထုတ်'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${data.amount.toLocaleString()} ကျပ်</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${data.status === 'approved' ? 'bg-green-100 text-green-800' : 
                                  data.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${data.status === 'approved' ? 'ခွင့်ပြုပြီး' : 
                                  data.status === 'pending' ? 'စောင့်ဆိုင်းနေ' : 'ငြင်းပယ်'}
                            </span>
                        </td>
                    `;
                });
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">လုပ်ငန်းမှတ်တမ်း မရှိပါ</td></tr>';
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
            }
        }

        async function loadTicketHistory() {
            if (!currentUser) return;
            
            try {
                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'tickets'),
                    window.firestore.where('userId', '==', currentUser.uid),
                    window.firestore.orderBy('createdAt', 'desc'),
                    window.firestore.limit(10)
                );
                
                const snapshot = await window.firestore.getDocs(q);
                const tbody = document.getElementById('ticketHistory');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(new Date())}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-bold">${data.ticketNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${data.amount.toLocaleString()} ကျပ်</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                ${data.status === 'active' ? 'စောင့်ဆိုင်းနေ' : 'ပြီးဆုံး'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-</td>
                    `;
                });
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">ထီလက်မှတ်မှတ်တမ်း မရှိပါ</td></tr>';
                }
            } catch (error) {
                console.error('Error loading tickets:', error);
            }
        }

        function loadDemoData() {
            // Load demo statistics
            document.getElementById('totalUsers').textContent = '1,234';
            document.getElementById('monthlyTickets').textContent = '5,678';
            document.getElementById('totalRevenue').textContent = '12,345,678 ကျပ်';
            document.getElementById('todayActivity').textContent = '89';
            
            // Load previous results
            const resultsContainer = document.getElementById('previousResults');
            const sampleResults = [
                { date: '2024-01-01', number: '123', prize: '1,000,000 ကျပ်' },
                { date: '2023-12-01', number: '456', prize: '800,000 ကျပ်' },
                { date: '2023-11-01', number: '789', prize: '1,200,000 ကျပ်' }
            ];
            
            resultsContainer.innerHTML = sampleResults.map(result => `
                <div class="bg-white border rounded-lg p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-bold text-lg">${result.number}</div>
                            <div class="text-sm text-gray-600">${result.date}</div>
                        </div>
                        <div class="text-green-600 font-bold">${result.prize}</div>
                    </div>
                </div>
            `).join('');
            
            // Initialize chart
            const ctx = document.getElementById('analysisChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'ထီပေါက်မှု ခန့်မှန်းချက်',
                        data: [12, 19, 3, 5, 2, 3],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Admin functions
        function showUserManagement() {
            document.getElementById('adminContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">အသုံးပြုသူ စီမံခန့်ခွဲမှု</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">အီးမေးလ်</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">နာမည်</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">လက်ကျန်</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">အခြေအနေ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">လုပ်ဆောင်ချက်များ</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">user1@example.com</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">User One</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">50,000 ကျပ်</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        Active
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <button class="text-blue-600 hover:text-blue-900 mr-2">Edit</button>
                                    <button class="text-red-600 hover:text-red-900">Block</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        function showPendingDeposits() {
            document.getElementById('adminContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">စောင့်ဆိုင်းနေသော ငွေသွင်းမှုများ</h3>
                <div class="space-y-4">
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold">user1@example.com</div>
                                <div class="text-sm text-gray-600">10,000 ကျပ် - KBZ Pay</div>
                            </div>
                            <div class="space-x-2">
                                <button class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">Approve</button>
                                <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Reject</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showPendingWithdrawals() {
            document.getElementById('adminContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">စောင့်ဆိုင်းနေသော ငွေထုတ်မှုများ</h3>
                <div class="space-y-4">
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold">user2@example.com</div>
                                <div class="text-sm text-gray-600">5,000 ကျပ် - Bank Account: 123456789</div>
                            </div>
                            <div class="space-x-2">
                                <button class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">Approve</button>
                                <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Reject</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createNewDraw() {
            document.getElementById('adminContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">ထွက်ပွဲအသစ် ဖန်တီးရန်</h3>
                <div class="max-w-md">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ထွက်ပွဲ ရက်စွဲ</label>
                        <input type="date" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ထွက်ပွဲ အချိန်</label>
                        <input type="time" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="18:00">
                    </div>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        ထွက်ပွဲ ဖန်တီးရန်
                    </button>
                </div>
            `;
        }

        function announceResults() {
            document.getElementById('adminContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">ရလဒ် ကြေညာရန်</h3>
                <div class="max-w-md">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ထွက်ပွဲ ရက်စွဲ</label>
                        <select class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option>2024-01-30</option>
                            <option>2024-02-29</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ထွက်သော နံပါတ်</label>
                        <input type="text" maxlength="3" placeholder="123" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <button class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        ရလဒ် ကြေညာရန်
                    </button>
                </div>
            `;
        }

        // Utility functions
        function formatDate(date) {
            return date.toLocaleDateString('my-MM', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        function getNextDrawDate() {
            const today = new Date();
            return new Date(today.getFullYear(), today.getMonth() + 1, 0);
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            } else {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }

        function toggleLanguage() {
            // Simple language toggle (for demo)
            const currentLangElement = document.getElementById('currentLang');
            currentLang = currentLang === 'my' ? 'en' : 'my';
            currentLangElement.textContent = currentLang === 'my' ? 'မြန်မာ' : 'English';
        }
    </script>
</body>
</html>
