<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Social App</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.js"></script>
    <!-- Material Icons -->
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #FF554F;
            --primary-light: #FF7A76;
            --primary-dark: #E43D38;
            --dark-bg: #0F0F23;
            --darker-bg: #0A0A1A;
            --card-bg: #1A1A2E;
            --input-bg: #16213E;
            --light-text: #EAEAEA;
            --gray-text: #9E9E9E;
            --border-color: #333366;
            --accent-purple: #6C63FF;
            --accent-blue: #4FC3F7;
            --success-green: #4CAF50;
            --shadow-primary: rgba(255, 85, 79, 0.3);
            --shadow-dark: rgba(0, 0, 0, 0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Roboto', 'Noto Sans Myanmar', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            margin: 0;
            padding: 0;
            color: var(--light-text);
            min-height: 100vh;
        }
        
        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        /* Enhanced Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 25px;
        }
        
        .search-bar {
            position: relative;
            background: linear-gradient(145deg, var(--card-bg), var(--input-bg));
            border-radius: 20px;
            padding: 4px;
            box-shadow: 0 8px 25px var(--shadow-dark);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(108, 99, 255, 0.2);
        }
        
        .search-bar:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px var(--shadow-primary);
            border-color: var(--primary-color);
        }
        
        .search-input {
            width: 100%;
            background: transparent;
            border: none;
            border-radius: 18px;
            padding: 16px 55px 16px 20px;
            color: var(--light-text);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            font-weight: 400;
        }
        
        .search-input::placeholder {
            color: var(--gray-text);
            opacity: 0.8;
        }
        
        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: var(--gray-text);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .search-bar:focus-within .search-icon {
            color: var(--primary-color);
            transform: translateY(-50%) scale(1.1);
        }
        
        .search-results-info {
            margin: 15px 0;
            font-size: 14px;
            color: var(--gray-text);
            font-weight: 500;
        }
        
        /* Enhanced FAB */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px var(--shadow-primary);
            cursor: pointer;
            z-index: 100;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }
        
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 35px var(--shadow-primary);
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        }
        
        .fab:active {
            transform: translateY(-3px) scale(1.05);
        }
        
        .fab-icon {
            color: white;
            font-size: 32px;
            font-weight: 300;
        }
        
        /* Enhanced Post Cards */
        .post-card {
            background: linear-gradient(145deg, var(--card-bg), rgba(26, 26, 46, 0.8));
            border-radius: 20px;
            margin-bottom: 30px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px var(--shadow-dark);
            border: 1px solid rgba(108, 99, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .post-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--shadow-dark);
            border-color: var(--primary-color);
        }
        
        .post-header {
            display: flex;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .profile-pic {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border: 3px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .profile-pic:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }
        
        .user-info {
            flex-grow: 1;
        }
        
        .user-name {
            font-weight: 600;
            margin: 0;
            font-size: 16px;
            background: linear-gradient(135deg, var(--light-text), var(--gray-text));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .post-time {
            color: var(--gray-text);
            font-size: 13px;
            margin: 5px 0 0 0;
            font-weight: 400;
        }
        
        .verified-badge {
            width: 18px;
            height: 18px;
            margin-left: 8px;
            filter: drop-shadow(0 2px 4px rgba(76, 175, 80, 0.3));
        }
        
        .options-icon {
            position: absolute;
            right: 20px;
            top: 20px;
            color: var(--gray-text);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 50%;
        }
        
        .options-icon:hover {
            color: var(--primary-color);
            background: rgba(255, 85, 79, 0.1);
            transform: scale(1.1);
        }
        
        .post-content {
            padding: 0 20px 20px;
        }
        
        .post-text {
            margin: 15px 0 20px;
            font-size: 16px;
            line-height: 1.6;
            color: var(--light-text);
            font-weight: 400;
        }
        
        .read-more {
            color: var(--primary-color);
            cursor: pointer;
            font-size: 14px;
            display: inline-block;
            margin-top: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .read-more:hover {
            color: var(--primary-light);
            transform: translateX(5px);
        }
        
        /* Enhanced Media Display */
        .post-media {
            margin-top: 20px;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .single-image, .post-video {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            display: block;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .post-video {
            background-color: #000000;
            outline: none;
        }
        
        .post-video::-webkit-media-controls-panel {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .multi-image-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 8px;
        }
        
        .multi-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .multi-image:hover, .single-image:hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255, 85, 79, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .video-overlay:hover {
            transform: translate(-50%, -50%) scale(1.1);
            background: var(--primary-color);
        }
        
        .video-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .video-indicator::before {
            content: "▶";
            margin-right: 6px;
            font-size: 10px;
        }
        
        /* Enhanced Post Footer */
        .post-footer {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            border-top: 1px solid rgba(51, 51, 102, 0.3);
            background: rgba(26, 26, 46, 0.5);
        }
        
        .action-button {
            display: flex;
            align-items: center;
            color: var(--gray-text);
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            border: 1px solid transparent;
        }
        
        .action-button:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--light-text);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .action-icon {
            margin-right: 8px;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .action-count {
            font-size: 14px;
            font-weight: 600;
        }
        
        .liked {
            color: var(--primary-color);
            background: rgba(255, 85, 79, 0.1);
            border-color: rgba(255, 85, 79, 0.3);
        }
        
        .liked:hover {
            background: rgba(255, 85, 79, 0.2);
            transform: translateY(-2px) scale(1.05);
        }
        
        /* Enhanced Navbar */
        .navbar {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, var(--darker-bg), var(--card-bg));
            backdrop-filter: blur(20px);
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            box-shadow: 0 8px 25px var(--shadow-dark);
            border-bottom: 1px solid rgba(108, 99, 255, 0.2);
        }
        
        .logo {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .user-menu {
            position: relative;
        }
        
        .user-menu-pic {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--primary-color);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow-primary);
        }
        
        .user-menu-pic:hover {
            transform: scale(1.1);
            border-color: var(--primary-light);
        }
        
        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 55px;
            background: linear-gradient(145deg, var(--card-bg), var(--input-bg));
            border-radius: 15px;
            padding: 12px 0;
            box-shadow: 0 15px 40px var(--shadow-dark);
            min-width: 180px;
            display: none;
            border: 1px solid rgba(108, 99, 255, 0.2);
            backdrop-filter: blur(20px);
        }
        
        .dropdown-menu.active {
            display: block;
            animation: dropdownFadeIn 0.3s ease;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .menu-icon {
            margin-right: 12px;
            font-size: 20px;
        }
        
        /* Enhanced Loading & Empty States */
        .no-posts {
            text-align: center;
            color: var(--gray-text);
            padding: 40px;
            font-size: 18px;
            background: linear-gradient(145deg, var(--card-bg), rgba(26, 26, 46, 0.8));
            border-radius: 20px;
            margin-top: 30px;
            border: 1px solid rgba(108, 99, 255, 0.1);
        }
        
        .skeleton-card {
            padding: 20px;
            margin-bottom: 25px;
            background: linear-gradient(145deg, var(--card-bg), rgba(26, 26, 46, 0.8));
            border-radius: 20px;
            border: 1px solid rgba(108, 99, 255, 0.1);
        }
        
        .skeleton {
            background: linear-gradient(90deg, var(--card-bg) 25%, rgba(108, 99, 255, 0.1) 50%, var(--card-bg) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }
        
        .skeleton-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .skeleton-pic {
            width: 52px;
            height: 52px;
            border-radius: 50%;
        }
        
        .skeleton-line {
            height: 16px;
            margin-bottom: 12px;
        }
        
        .skeleton-image {
            height: 220px;
            margin-top: 20px;
            border-radius: 12px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Enhanced Toast */
        .toast {
            position: fixed;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(26, 26, 46, 0.95));
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 8px 25px var(--shadow-dark);
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            pointer-events: none;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(108, 99, 255, 0.2);
        }
        
        .toast.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-15px);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .navbar {
                padding: 12px 20px;
            }
            
            .logo {
                font-size: 22px;
            }
            
            .post-card {
                margin-bottom: 20px;
            }
            
            .fab {
                width: 60px;
                height: 60px;
                bottom: 25px;
                right: 25px;
            }
            
            .fab-icon {
                font-size: 28px;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--darker-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-purple));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--accent-blue));
        }
    </style>
</head>
<body>
    <!-- Enhanced Navbar -->
    <div class="navbar">
        <div class="logo">Social App</div>
        <div class="user-menu" id="user-menu">
            <img src="user.png" id="user-menu-pic" class="user-menu-pic" alt="User">
            <div class="dropdown-menu" id="dropdown-menu">
                <div class="menu-item" onclick="goToProfile()">
                    <span class="menu-icon mdi mdi-account"></span>
                    Profile
                </div>
                <div class="menu-item" onclick="goToSettings()">
                    <span class="menu-icon mdi mdi-cog"></span>
                    Settings
                </div>
                <div class="menu-item" onclick="logout()">
                    <span class="menu-icon mdi mdi-logout"></span>
                    Logout
                </div>
            </div>
        </div>
    </div>

    <div class="container">
           <!-- Enhanced Search Bar -->
        <div class="search-container">
            <div class="search-bar">
                <input type="text" class="search-input" id="search-input" placeholder="ပိုစ့်များကို ရှာရန်...">
                <span class="search-icon mdi mdi-magnify" id="search-icon"></span>
            </div>
            <div class="search-results-info" id="search-results-info" style="display: none;"></div>
        </div>
        
        <!-- Posts Container -->
        <div id="posts-container">
            <!-- Enhanced Skeleton loading -->
            <div class="skeleton-card">
                <div class="skeleton-header">
                    <div class="skeleton skeleton-pic"></div>
                    <div style="margin-left: 15px; flex: 1;">
                        <div class="skeleton skeleton-line" style="width: 45%;"></div>
                        <div class="skeleton skeleton-line" style="width: 30%;"></div>
                    </div>
                </div>
                <div class="skeleton skeleton-line" style="width: 100%;"></div>
                <div class="skeleton skeleton-line" style="width: 85%;"></div>
                <div class="skeleton skeleton-image"></div>
            </div>
            <div class="skeleton-card">
                <div class="skeleton-header">
                    <div class="skeleton skeleton-pic"></div>
                    <div style="margin-left: 15px; flex: 1;">
                        <div class="skeleton skeleton-line" style="width: 40%;"></div>
                        <div class="skeleton skeleton-line" style="width: 25%;"></div>
                    </div>
                </div>
                <div class="skeleton skeleton-line" style="width: 95%;"></div>
                <div class="skeleton skeleton-line" style="width: 80%;"></div>
                <div class="skeleton skeleton-image"></div>
            </div>
        </div>
        
        <!-- Enhanced FAB Button -->
        <div class="fab" onclick="goToUpload()">
            <span class="fab-icon mdi mdi-plus"></span>
        </div>
        
        <!-- Enhanced Toast Notification -->
        <div id="toast" class="toast"></div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB49vRPX8YaWuTP5GS3lsBDqdAaz_hJYAw",
            authDomain: "onlineshop-849c8.firebaseapp.com",
            databaseURL: "https://onlineshop-849c8.firebaseio.com",
            projectId: "onlineshop-849c8",
            storageBucket: "onlineshop-849c8.appspot.com",
            messagingSenderId: "883512833370",
            appId: "1:883512833370:web:a1c8412b158f8744afef63"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Current user and post data
        let currentUser = null;
        let allPosts = [];
        let filteredPosts = [];
        let users = {};
        let likedPosts = {};
        let searchTimeout = null;

        // DOM elements
        const postsContainer = document.getElementById('posts-container');
        const searchInput = document.getElementById('search-input');
        const searchIcon = document.getElementById('search-icon');
        const searchResultsInfo = document.getElementById('search-results-info');
        const userMenuPic = document.getElementById('user-menu-pic');
        const userMenu = document.getElementById('user-menu');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const toast = document.getElementById('toast');

        // Toggle dropdown menu
        userMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!userMenu.contains(e.target)) {
                dropdownMenu.classList.remove('active');
            }
        });

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadData();
                
                // Get user profile pic
                database.ref(`users/${user.uid}/profilepic`).once('value')
                    .then(snapshot => {
                        const profilePic = snapshot.val();
                        if (profilePic) {
                            userMenuPic.src = profilePic;
                        }
                    });
                
                // Setup enhanced search functionality
                setupSearch();
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'index.html';
            }
        });

        // Enhanced search setup
        function setupSearch() {
            searchInput.addEventListener('input', handleSearchInput);
            searchIcon.addEventListener('click', performSearch);
            
            // Search on Enter key
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }

        // Handle search input with debouncing
        function handleSearchInput() {
            const query = searchInput.value.trim();
            
            // Clear previous timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            // Update search icon
            searchIcon.style.color = query ? 'var(--primary-color)' : 'var(--gray-text)';
            
            // Debounced search
            searchTimeout = setTimeout(() => {
                performSearch();
            }, 300);
        }

        // Perform search
        function performSearch() {
            const searchQuery = searchInput.value.trim().toLowerCase();
            
            if (searchQuery === '') {
                filteredPosts = [...allPosts];
                searchResultsInfo.style.display = 'none';
                searchIcon.style.color = 'var(--gray-text)';
            } else {
                filteredPosts = allPosts.filter(post => {
                    const description = post.description ? post.description.toLowerCase() : '';
                    const userName = users[post.uid] ? users[post.uid].name.toLowerCase() : '';
                    return description.includes(searchQuery) || userName.includes(searchQuery);
                });
                
                // Show search results info
                searchResultsInfo.style.display = 'block';
                const resultCount = filteredPosts.length;
                const searchTerm = searchInput.value.trim();
                searchResultsInfo.textContent = `"${searchTerm}" အတွက် ရလဒ် ${resultCount} ခု တွေ့ရှိခဲ့သည်`;
                
                // Update search icon based on results
                searchIcon.style.color = resultCount > 0 ? 'var(--success-green)' : 'var(--primary-color)';
            }
            
            renderPosts();
        }

        // Show toast notification
        function showToast(message, duration = 3000) {
            toast.textContent = message;
            toast.classList.add('visible');
            
            setTimeout(() => {
                toast.classList.remove('visible');
            }, duration);
        }

        // Load all data
        function loadData() {
            // Load posts
            database.ref('posts').orderByChild('post_timestamp').once('value')
                .then((snapshot) => {
                    allPosts = [];
                    snapshot.forEach((childSnapshot) => {
                        const post = childSnapshot.val();
                        post.key = childSnapshot.key;
                        allPosts.unshift(post); // Newest first
                    });
                    filteredPosts = [...allPosts];
                    
                    // Load users
                    return database.ref('users').once('value');
                })
                .then((snapshot) => {
                    users = snapshot.val() || {};
                    
                    // Load liked posts
                    return database.ref(`likes/${currentUser.uid}`).once('value');
                })
                .then((snapshot) => {
                    const likesData = snapshot.val() || {};
                    likedPosts = {};
                    
                    // Create a map of liked posts
                    Object.keys(likesData).forEach(postId => {
                        if (likesData[postId] === true) {
                            likedPosts[postId] = true;
                        }
                    });
                    
                    renderPosts();
                })
                .catch((error) => {
                    console.error("Error loading data:", error);
                    showToast("ဒေတာများ ရယူရာတွင် အမှားအယွင်းရှိသည်။");
                });
        }
               // Render posts to UI
        function renderPosts() {
            postsContainer.innerHTML = '';
            
            if (filteredPosts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="no-posts">
                        <div style="font-size: 48px; margin-bottom: 15px;">😢</div>
                        <div>ပိုစ့်များ မတွေ့ရှိပါ</div>
                    </div>
                `;
                return;
            }
            
            filteredPosts.forEach(post => {
                const user = users[post.uid] || { name: "အမည်မသိ အသုံးပြုသူ", profilepic: "user.png" };
                const isLiked = likedPosts[post.key] === true;
                
                // Create post element
                const postElement = document.createElement('div');
                postElement.className = 'post-card';
                postElement.onclick = () => viewPost(post.key);
                
                // Format timestamp
                const postDate = new Date(post.post_timestamp);
                const timeAgo = formatTimeAgo(postDate);
                
                // Set up media content
                let mediaContent = '';
                
                if (post.media && post.media.length > 0) {
                    if (post.media.length === 1) {
                        const media = post.media[0];
                        if (media.type === 'image') {
                            mediaContent = `
                                <div class="post-media">
                                    <img src="${media.url}" alt="Post image" class="single-image" loading="lazy">
                                </div>
                            `;
                        } else if (media.type === 'video') {
                            mediaContent = `
                                <div class="post-media">
                                    <video class="post-video" controls>
                                        <source src="${media.url}" type="video/mp4">
                                        သင့်ဘရောက်ဇာသည် ဗီဒီယိုကို မထောက်ပံ့ပါ။
                                    </video>
                                    <div class="video-indicator">ဗီဒီယို</div>
                                </div>
                            `;
                        }
                    } else {
                        // Multiple images
                        mediaContent = `<div class="post-media multi-image-container">`;
                        
                        post.media.slice(0, 4).forEach((media, index) => {
                            if (media.type === 'image') {
                                mediaContent += `
                                    <img src="${media.url}" alt="Post image ${index+1}" class="multi-image" loading="lazy">
                                `;
                            }
                        });
                        
                        mediaContent += `</div>`;
                    }
                }
                
                // Limit description length
                let description = post.description || '';
                let fullDescription = description;
                let readMoreLink = '';
                
                if (description.length > 150) {
                    description = description.substring(0, 150) + '...';
                    readMoreLink = '<span class="read-more">ဆက်ဖတ်ရန်...</span>';
                }
                
                // Build post HTML
                postElement.innerHTML = `
                    <div class="post-header">
                        <img src="${user.profilepic || 'user.png'}" alt="${user.name}" class="profile-pic">
                        <div class="user-info">
                            <p class="user-name">${user.name}${user.verified ? '<img src="verified.png" class="verified-badge" alt="Verified">' : ''}</p>
                            <p class="post-time">${timeAgo}</p>
                        </div>
                        <span class="options-icon mdi mdi-dots-vertical" onclick="showPostOptions(event, '${post.key}')"></span>
                    </div>
                    <div class="post-content">
                        <div class="post-text">${description}${readMoreLink}</div>
                        ${mediaContent}
                    </div>
                    <div class="post-footer">
                        <div class="action-button ${isLiked ? 'liked' : ''}" onclick="likePost(event, '${post.key}')">
                            <span class="action-icon mdi mdi-heart${isLiked ? '' : '-outline'}"></span>
                            <span class="action-count">${post.likes || 0}</span>
                        </div>
                        <div class="action-button" onclick="showComments(event, '${post.key}')">
                            <span class="action-icon mdi mdi-comment-outline"></span>
                            <span class="action-count">${post.comments_count || 0}</span>
                        </div>
                        <div class="action-button" onclick="sharePost(event, '${post.key}')">
                            <span class="action-icon mdi mdi-share-variant"></span>
                        </div>
                    </div>
                `;
                
                postsContainer.appendChild(postElement);
            });
        }
        
        // Format time ago
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSecs < 60) {
                return `ယခုလေးတင်`;
            } else if (diffMins < 60) {
                return `${diffMins} မိနစ်က`;
            } else if (diffHours < 24) {
                return `${diffHours} နာရီက`;
            } else if (diffDays < 30) {
                return `${diffDays} ရက်က`;
            } else {
                // Format date
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
        }
        
        // Like a post
        function likePost(event, postId) {
            event.stopPropagation(); // Prevent post click
            
            // Toggle like
            const isCurrentlyLiked = likedPosts[postId] === true;
            
            // Reference to the post's likes
            const postRef = database.ref(`posts/${postId}`);
            const userLikesRef = database.ref(`likes/${currentUser.uid}/${postId}`);
            
            if (isCurrentlyLiked) {
                // Remove like
                postRef.child('likes').transaction((likes) => {
                    return (likes || 0) - 1;
                });
                userLikesRef.remove();
                likedPosts[postId] = false;
                showToast('ကြိုက်တယ် ဖယ်ရှားလိုက်သည်');
            } else {
                // Add like
                postRef.child('likes').transaction((likes) => {
                    return (likes || 0) + 1;
                });
                userLikesRef.set(true);
                likedPosts[postId] = true;
                showToast('ကြိုက်တယ် သတ်မှတ်လိုက်သည်');
            }
            
            // Update UI
            const likeButton = event.currentTarget;
            const likeIcon = likeButton.querySelector('.action-icon');
            const likeCount = likeButton.querySelector('.action-count');
            
            // Toggle liked class
            likeButton.classList.toggle('liked');
            
            // Update icon and count
            if (isCurrentlyLiked) {
                likeIcon.classList.replace('mdi-heart', 'mdi-heart-outline');
                likeCount.textContent = parseInt(likeCount.textContent) - 1;
            } else {
                likeIcon.classList.replace('mdi-heart-outline', 'mdi-heart');
                likeCount.textContent = parseInt(likeCount.textContent) + 1;
            }
        }
        
        // View post details
        function viewPost(postId) {
            window.location.href = `post.html?id=${postId}`;
        }
        
        // Show comments
        function showComments(event, postId) {
            event.stopPropagation(); // Prevent post click
            window.location.href = `post.html?id=${postId}#comments`;
        }
        
        // Share post
        function sharePost(event, postId) {
            event.stopPropagation(); // Prevent post click
            
            // Create share URL
            const shareUrl = `${window.location.origin}/post.html?id=${postId}`;
            
            // Check if Web Share API is supported
            if (navigator.share) {
                navigator.share({
                    title: 'Social App မှ မျှဝေခြင်း',
                    url: shareUrl
                })
                .then(() => {
                    showToast('အောင်မြင်စွာ မျှဝေပြီးပါပြီ');
                })
                .catch(err => {
                    console.error('Share failed:', err);
                    copyToClipboard(shareUrl);
                });
            } else {
                // Fallback to clipboard
                copyToClipboard(shareUrl);
            }
        }
        
        // Copy to clipboard
        function copyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('လင့်ခ်အား ကူးယူပြီးပါပြီ');
            } catch (err) {
                console.error('Copy failed:', err);
                showToast('ကူးယူရန် မအောင်မြင်ပါ');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Show post options
        function showPostOptions(event, postId) {
            event.stopPropagation(); // Prevent post click
            
            // Get the post
            const post = allPosts.find(p => p.key === postId);
            
            // Check if current user is the post owner
            const isOwner = post && post.uid === currentUser.uid;
            
            // Create options popup
            const optionsMenu = document.createElement('div');
            optionsMenu.className = 'dropdown-menu active';
            optionsMenu.style.position = 'fixed';
            optionsMenu.style.zIndex = '1000';
            
            // Position near the clicked element
            const rect = event.target.getBoundingClientRect();
            optionsMenu.style.top = `${rect.bottom + 5}px`;
            optionsMenu.style.right = `${window.innerWidth - rect.right}px`;
            
            // Add menu items
            if (isOwner) {
                optionsMenu.innerHTML = `
                    <div class="menu-item" onclick="editPost('${postId}')">
                        <span class="menu-icon mdi mdi-pencil"></span>
                        တည်းဖြတ်ရန်
                    </div>
                    <div class="menu-item" onclick="deletePost('${postId}')">
                        <span class="menu-icon mdi mdi-delete"></span>
                        ဖျက်ရန်
                    </div>
                `;
            } else {
                optionsMenu.innerHTML = `
                    <div class="menu-item" onclick="reportPost('${postId}')">
                        <span class="menu-icon mdi mdi-flag"></span>
                        တိုင်ကြားရန်
                    </div>
                    <div class="menu-item" onclick="hidePost('${postId}')">
                        <span class="menu-icon mdi mdi-eye-off"></span>
                        ဖျောက်ထားရန်
                    </div>
                `;
            }
            // Add to document and setup auto-close
            document.body.appendChild(optionsMenu);
            
            // Close when clicking outside
            const closeMenu = (e) => {
                if (!optionsMenu.contains(e.target) {
                    document.body.removeChild(optionsMenu);
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            document.addEventListener('click', closeMenu);
        }
        
        // Edit post
        function editPost(postId) {
            window.location.href = `edit-post.html?id=${postId}`;
        }
        
        // Delete post
        function deletePost(postId) {
            if (confirm('ဒီပိုစ့်ကို ဖျက်ရန် သေချာပါသလား?')) {
                // Delete post from database
                database.ref(`posts/${postId}`).remove()
                    .then(() => {
                        showToast('ပိုစ့်အား ဖျက်ပြီးပါပြီ');
                        
                        // Remove from both arrays
                        allPosts = allPosts.filter(post => post.key !== postId);
                        filteredPosts = filteredPosts.filter(post => post.key !== postId);
                        
                        // Re-render
                        renderPosts();
                    })
                    .catch(error => {
                        console.error("Error deleting post:", error);
                        showToast('ဖျက်ရာတွင် အမှားရှိသည်');
                    });
            }
        }
        
        // Report post
        function reportPost(postId) {
            // Get the report reason
            const reason = prompt('ဤပိုစ့်အား တိုင်ကြားရသည့် အကြောင်းရင်းကို ဖော်ပြပါ:');
            
            if (reason) {
                // Create a report object
                const reportData = {
                    postId: postId,
                    reporterId: currentUser.uid,
                    reason: reason,
                    timestamp: Date.now()
                };
                
                // Save report to database
                database.ref('reports').push(reportData)
                    .then(() => {
                        showToast('တိုင်ကြားမှုကို လက်ခံရရှိပါပြီ');
                    })
                    .catch(error => {
                        console.error("Error reporting post:", error);
                        showToast('တိုင်ကြားရာတွင် အမှားရှိသည်');
                    });
            }
        }
        
        // Hide post
        function hidePost(postId) {
            // Filter out the post from UI
            filteredPosts = filteredPosts.filter(post => post.key !== postId);
            renderPosts();
            showToast('ဤပိုစ့်အား ဖျောက်ထားပါပြီ');
            
            // Save to user's hidden posts (optional)
            database.ref(`users/${currentUser.uid}/hidden_posts/${postId}`).set(true)
                .catch(error => {
                    console.error("Error hiding post:", error);
                });
        }
        
        // Navigation functions
        function goToProfile() {
            window.location.href = 'profile.html';
        }
        
        function goToSettings() {
            window.location.href = 'settings.html';
        }
        
        function goToUpload() {
            window.location.href = 'create-post.html';
        }
        
        // Logout function
        function logout() {
            auth.signOut()
                .then(() => {
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    console.error("Error signing out:", error);
                    showToast('ထွက်ရန် မအောင်မြင်ပါ');
                });
        }
    </script>
</body>
</html>
